VERSION 5.00
Object = "{6B7E6392-850A-101B-AFC0-4210102A8DA7}#1.3#0"; "COMCTL32.OCX"
Begin VB.Form form1 
   BorderStyle     =   5  'Sizable ToolWindow
   Caption         =   "Chess"
   ClientHeight    =   8745
   ClientLeft      =   120
   ClientTop       =   390
   ClientWidth     =   13755
   LinkTopic       =   "Form1"
   PaletteMode     =   2  'Custom
   ScaleHeight     =   8745
   ScaleWidth      =   13755
   ShowInTaskbar   =   0   'False
   StartUpPosition =   2  'CenterScreen
   Begin VB.CommandButton Command1 
      Caption         =   "START"
      Height          =   1455
      Left            =   9360
      TabIndex        =   64
      Top             =   3600
      Width           =   2535
   End
   Begin VB.PictureBox Picture1 
      BackColor       =   &H8000000E&
      Height          =   855
      Index           =   63
      Left            =   7560
      ScaleHeight     =   795
      ScaleWidth      =   915
      TabIndex        =   63
      Top             =   6600
      Width           =   975
   End
   Begin VB.PictureBox Picture1 
      BackColor       =   &H80000007&
      Height          =   855
      Index           =   62
      Left            =   6600
      ScaleHeight     =   795
      ScaleWidth      =   915
      TabIndex        =   62
      Top             =   6600
      Width           =   975
   End
   Begin VB.PictureBox Picture1 
      BackColor       =   &H8000000E&
      Height          =   855
      Index           =   61
      Left            =   5640
      ScaleHeight     =   795
      ScaleWidth      =   915
      TabIndex        =   61
      Top             =   6600
      Width           =   975
   End
   Begin VB.PictureBox Picture1 
      BackColor       =   &H80000007&
      Height          =   855
      Index           =   60
      Left            =   4680
      ScaleHeight     =   795
      ScaleWidth      =   915
      TabIndex        =   60
      Top             =   6600
      Width           =   975
   End
   Begin VB.PictureBox Picture1 
      BackColor       =   &H8000000E&
      Height          =   855
      Index           =   59
      Left            =   3720
      ScaleHeight     =   795
      ScaleWidth      =   915
      TabIndex        =   59
      Top             =   6600
      Width           =   975
   End
   Begin VB.PictureBox Picture1 
      BackColor       =   &H80000007&
      Height          =   855
      Index           =   58
      Left            =   2760
      ScaleHeight     =   795
      ScaleWidth      =   915
      TabIndex        =   58
      Top             =   6600
      Width           =   975
   End
   Begin VB.PictureBox Picture1 
      BackColor       =   &H8000000E&
      Height          =   855
      Index           =   57
      Left            =   1800
      ScaleHeight     =   795
      ScaleWidth      =   915
      TabIndex        =   57
      Top             =   6600
      Width           =   975
   End
   Begin VB.PictureBox Picture1 
      BackColor       =   &H80000007&
      Height          =   855
      Index           =   56
      Left            =   840
      ScaleHeight     =   795
      ScaleWidth      =   915
      TabIndex        =   56
      Top             =   6600
      Width           =   975
   End
   Begin VB.PictureBox Picture1 
      BackColor       =   &H80000007&
      Height          =   855
      Index           =   55
      Left            =   7560
      ScaleHeight     =   795
      ScaleWidth      =   915
      TabIndex        =   55
      Top             =   5760
      Width           =   975
   End
   Begin VB.PictureBox Picture1 
      BackColor       =   &H8000000E&
      Height          =   855
      Index           =   54
      Left            =   6600
      ScaleHeight     =   795
      ScaleWidth      =   915
      TabIndex        =   54
      Top             =   5760
      Width           =   975
   End
   Begin VB.PictureBox Picture1 
      BackColor       =   &H80000007&
      Height          =   855
      Index           =   53
      Left            =   5640
      ScaleHeight     =   795
      ScaleWidth      =   915
      TabIndex        =   53
      Top             =   5760
      Width           =   975
   End
   Begin VB.PictureBox Picture1 
      BackColor       =   &H8000000E&
      Height          =   855
      Index           =   52
      Left            =   4680
      ScaleHeight     =   795
      ScaleWidth      =   915
      TabIndex        =   52
      Top             =   5760
      Width           =   975
   End
   Begin VB.PictureBox Picture1 
      BackColor       =   &H80000007&
      Height          =   855
      Index           =   51
      Left            =   3720
      ScaleHeight     =   795
      ScaleWidth      =   915
      TabIndex        =   51
      Top             =   5760
      Width           =   975
   End
   Begin VB.PictureBox Picture1 
      BackColor       =   &H8000000E&
      Height          =   855
      Index           =   50
      Left            =   2760
      ScaleHeight     =   795
      ScaleWidth      =   915
      TabIndex        =   50
      Top             =   5760
      Width           =   975
   End
   Begin VB.PictureBox Picture1 
      BackColor       =   &H80000007&
      Height          =   855
      Index           =   49
      Left            =   1800
      ScaleHeight     =   795
      ScaleWidth      =   915
      TabIndex        =   49
      Top             =   5760
      Width           =   975
   End
   Begin VB.PictureBox Picture1 
      BackColor       =   &H8000000E&
      Height          =   855
      Index           =   48
      Left            =   840
      ScaleHeight     =   795
      ScaleWidth      =   915
      TabIndex        =   48
      Top             =   5760
      Width           =   975
   End
   Begin VB.PictureBox Picture1 
      BackColor       =   &H8000000E&
      Height          =   855
      Index           =   47
      Left            =   7560
      ScaleHeight     =   795
      ScaleWidth      =   915
      TabIndex        =   47
      Top             =   4920
      Width           =   975
   End
   Begin VB.PictureBox Picture1 
      BackColor       =   &H80000007&
      Height          =   855
      Index           =   46
      Left            =   6600
      ScaleHeight     =   795
      ScaleWidth      =   915
      TabIndex        =   46
      Top             =   4920
      Width           =   975
   End
   Begin VB.PictureBox Picture1 
      BackColor       =   &H8000000E&
      Height          =   855
      Index           =   45
      Left            =   5640
      ScaleHeight     =   795
      ScaleWidth      =   915
      TabIndex        =   45
      Top             =   4920
      Width           =   975
   End
   Begin VB.PictureBox Picture1 
      BackColor       =   &H80000007&
      Height          =   855
      Index           =   44
      Left            =   4680
      ScaleHeight     =   795
      ScaleWidth      =   915
      TabIndex        =   44
      Top             =   4920
      Width           =   975
   End
   Begin VB.PictureBox Picture1 
      BackColor       =   &H8000000E&
      Height          =   855
      Index           =   43
      Left            =   3720
      ScaleHeight     =   795
      ScaleWidth      =   915
      TabIndex        =   43
      Top             =   4920
      Width           =   975
   End
   Begin VB.PictureBox Picture1 
      BackColor       =   &H80000007&
      Height          =   855
      Index           =   42
      Left            =   2760
      ScaleHeight     =   795
      ScaleWidth      =   915
      TabIndex        =   42
      Top             =   4920
      Width           =   975
   End
   Begin VB.PictureBox Picture1 
      BackColor       =   &H8000000E&
      Height          =   855
      Index           =   41
      Left            =   1800
      ScaleHeight     =   795
      ScaleWidth      =   915
      TabIndex        =   41
      Top             =   4920
      Width           =   975
   End
   Begin VB.PictureBox Picture1 
      BackColor       =   &H80000007&
      Height          =   855
      Index           =   40
      Left            =   840
      ScaleHeight     =   795
      ScaleWidth      =   915
      TabIndex        =   40
      Top             =   4920
      Width           =   975
   End
   Begin VB.PictureBox Picture1 
      BackColor       =   &H80000007&
      Height          =   855
      Index           =   39
      Left            =   7560
      ScaleHeight     =   795
      ScaleWidth      =   915
      TabIndex        =   39
      Top             =   4080
      Width           =   975
   End
   Begin VB.PictureBox Picture1 
      BackColor       =   &H8000000E&
      Height          =   855
      Index           =   38
      Left            =   6600
      ScaleHeight     =   795
      ScaleWidth      =   915
      TabIndex        =   38
      Top             =   4080
      Width           =   975
   End
   Begin VB.PictureBox Picture1 
      BackColor       =   &H80000007&
      Height          =   855
      Index           =   37
      Left            =   5640
      ScaleHeight     =   795
      ScaleWidth      =   915
      TabIndex        =   37
      Top             =   4080
      Width           =   975
   End
   Begin VB.PictureBox Picture1 
      BackColor       =   &H8000000E&
      Height          =   855
      Index           =   36
      Left            =   4680
      ScaleHeight     =   795
      ScaleWidth      =   915
      TabIndex        =   36
      Top             =   4080
      Width           =   975
   End
   Begin VB.PictureBox Picture1 
      BackColor       =   &H80000007&
      Height          =   855
      Index           =   35
      Left            =   3720
      ScaleHeight     =   795
      ScaleWidth      =   915
      TabIndex        =   35
      Top             =   4080
      Width           =   975
   End
   Begin VB.PictureBox Picture1 
      BackColor       =   &H8000000E&
      Height          =   855
      Index           =   34
      Left            =   2760
      ScaleHeight     =   795
      ScaleWidth      =   915
      TabIndex        =   34
      Top             =   4080
      Width           =   975
   End
   Begin VB.PictureBox Picture1 
      BackColor       =   &H80000007&
      Height          =   855
      Index           =   33
      Left            =   1800
      ScaleHeight     =   795
      ScaleWidth      =   915
      TabIndex        =   33
      Top             =   4080
      Width           =   975
   End
   Begin VB.PictureBox Picture1 
      BackColor       =   &H8000000E&
      Height          =   855
      Index           =   32
      Left            =   840
      ScaleHeight     =   795
      ScaleWidth      =   915
      TabIndex        =   32
      Top             =   4080
      Width           =   975
   End
   Begin VB.PictureBox Picture1 
      BackColor       =   &H8000000E&
      Height          =   855
      Index           =   31
      Left            =   7560
      ScaleHeight     =   795
      ScaleWidth      =   915
      TabIndex        =   31
      Top             =   3240
      Width           =   975
   End
   Begin VB.PictureBox Picture1 
      BackColor       =   &H80000007&
      Height          =   855
      Index           =   30
      Left            =   6600
      ScaleHeight     =   795
      ScaleWidth      =   915
      TabIndex        =   30
      Top             =   3240
      Width           =   975
   End
   Begin VB.PictureBox Picture1 
      BackColor       =   &H8000000E&
      Height          =   855
      Index           =   29
      Left            =   5640
      ScaleHeight     =   795
      ScaleWidth      =   915
      TabIndex        =   29
      Top             =   3240
      Width           =   975
   End
   Begin VB.PictureBox Picture1 
      BackColor       =   &H80000007&
      Height          =   855
      Index           =   28
      Left            =   4680
      ScaleHeight     =   795
      ScaleWidth      =   915
      TabIndex        =   28
      Top             =   3240
      Width           =   975
   End
   Begin VB.PictureBox Picture1 
      BackColor       =   &H8000000E&
      Height          =   855
      Index           =   27
      Left            =   3720
      ScaleHeight     =   795
      ScaleWidth      =   915
      TabIndex        =   27
      Top             =   3240
      Width           =   975
   End
   Begin VB.PictureBox Picture1 
      BackColor       =   &H80000007&
      Height          =   855
      Index           =   26
      Left            =   2760
      ScaleHeight     =   795
      ScaleWidth      =   915
      TabIndex        =   26
      Top             =   3240
      Width           =   975
   End
   Begin VB.PictureBox Picture1 
      BackColor       =   &H8000000E&
      Height          =   855
      Index           =   25
      Left            =   1800
      ScaleHeight     =   795
      ScaleWidth      =   915
      TabIndex        =   25
      Top             =   3240
      Width           =   975
   End
   Begin VB.PictureBox Picture1 
      BackColor       =   &H80000007&
      Height          =   855
      Index           =   24
      Left            =   840
      ScaleHeight     =   795
      ScaleWidth      =   915
      TabIndex        =   24
      Top             =   3240
      Width           =   975
   End
   Begin VB.PictureBox Picture1 
      BackColor       =   &H80000007&
      Height          =   855
      Index           =   23
      Left            =   7560
      ScaleHeight     =   795
      ScaleWidth      =   915
      TabIndex        =   23
      Top             =   2400
      Width           =   975
   End
   Begin VB.PictureBox Picture1 
      BackColor       =   &H8000000E&
      Height          =   855
      Index           =   22
      Left            =   6600
      ScaleHeight     =   795
      ScaleWidth      =   915
      TabIndex        =   22
      Top             =   2400
      Width           =   975
   End
   Begin VB.PictureBox Picture1 
      BackColor       =   &H80000007&
      Height          =   855
      Index           =   21
      Left            =   5640
      ScaleHeight     =   795
      ScaleWidth      =   915
      TabIndex        =   21
      Top             =   2400
      Width           =   975
   End
   Begin VB.PictureBox Picture1 
      BackColor       =   &H8000000E&
      Height          =   855
      Index           =   20
      Left            =   4680
      ScaleHeight     =   795
      ScaleWidth      =   915
      TabIndex        =   20
      Top             =   2400
      Width           =   975
   End
   Begin VB.PictureBox Picture1 
      BackColor       =   &H80000007&
      Height          =   855
      Index           =   19
      Left            =   3720
      ScaleHeight     =   795
      ScaleWidth      =   915
      TabIndex        =   19
      Top             =   2400
      Width           =   975
   End
   Begin VB.PictureBox Picture1 
      BackColor       =   &H8000000E&
      Height          =   855
      Index           =   18
      Left            =   2760
      ScaleHeight     =   795
      ScaleWidth      =   915
      TabIndex        =   18
      Top             =   2400
      Width           =   975
   End
   Begin VB.PictureBox Picture1 
      BackColor       =   &H80000007&
      Height          =   855
      Index           =   17
      Left            =   1800
      ScaleHeight     =   795
      ScaleWidth      =   915
      TabIndex        =   17
      Top             =   2400
      Width           =   975
   End
   Begin VB.PictureBox Picture1 
      BackColor       =   &H8000000E&
      Height          =   855
      Index           =   16
      Left            =   840
      ScaleHeight     =   795
      ScaleWidth      =   915
      TabIndex        =   16
      Top             =   2400
      Width           =   975
   End
   Begin VB.PictureBox Picture1 
      BackColor       =   &H8000000E&
      Height          =   855
      Index           =   15
      Left            =   7560
      ScaleHeight     =   795
      ScaleWidth      =   915
      TabIndex        =   15
      Top             =   1560
      Width           =   975
   End
   Begin VB.PictureBox Picture1 
      BackColor       =   &H80000007&
      Height          =   855
      Index           =   14
      Left            =   6600
      ScaleHeight     =   795
      ScaleWidth      =   915
      TabIndex        =   14
      Top             =   1560
      Width           =   975
   End
   Begin VB.PictureBox Picture1 
      BackColor       =   &H8000000E&
      Height          =   855
      Index           =   13
      Left            =   5640
      ScaleHeight     =   795
      ScaleWidth      =   915
      TabIndex        =   13
      Top             =   1560
      Width           =   975
   End
   Begin VB.PictureBox Picture1 
      BackColor       =   &H80000007&
      Height          =   855
      Index           =   12
      Left            =   4680
      ScaleHeight     =   795
      ScaleWidth      =   915
      TabIndex        =   12
      Top             =   1560
      Width           =   975
   End
   Begin VB.PictureBox Picture1 
      BackColor       =   &H8000000E&
      Height          =   855
      Index           =   11
      Left            =   3720
      ScaleHeight     =   795
      ScaleWidth      =   915
      TabIndex        =   11
      Top             =   1560
      Width           =   975
   End
   Begin VB.PictureBox Picture1 
      BackColor       =   &H80000007&
      Height          =   855
      Index           =   10
      Left            =   2760
      ScaleHeight     =   795
      ScaleWidth      =   915
      TabIndex        =   10
      Top             =   1560
      Width           =   975
   End
   Begin VB.PictureBox Picture1 
      BackColor       =   &H8000000E&
      Height          =   855
      Index           =   9
      Left            =   1800
      ScaleHeight     =   795
      ScaleWidth      =   915
      TabIndex        =   9
      Top             =   1560
      Width           =   975
   End
   Begin VB.PictureBox Picture1 
      BackColor       =   &H80000007&
      Height          =   855
      Index           =   8
      Left            =   840
      ScaleHeight     =   795
      ScaleWidth      =   915
      TabIndex        =   8
      Top             =   1560
      Width           =   975
   End
   Begin VB.PictureBox Picture1 
      BackColor       =   &H80000007&
      Height          =   855
      Index           =   7
      Left            =   7560
      ScaleHeight     =   795
      ScaleWidth      =   915
      TabIndex        =   7
      Top             =   720
      Width           =   975
   End
   Begin VB.PictureBox Picture1 
      BackColor       =   &H8000000E&
      Height          =   855
      Index           =   6
      Left            =   6600
      ScaleHeight     =   795
      ScaleWidth      =   915
      TabIndex        =   6
      Top             =   720
      Width           =   975
   End
   Begin VB.PictureBox Picture1 
      BackColor       =   &H80000007&
      Height          =   855
      Index           =   5
      Left            =   5640
      ScaleHeight     =   795
      ScaleWidth      =   915
      TabIndex        =   5
      Top             =   720
      Width           =   975
   End
   Begin VB.PictureBox Picture1 
      BackColor       =   &H8000000E&
      Height          =   855
      Index           =   4
      Left            =   4680
      ScaleHeight     =   795
      ScaleWidth      =   915
      TabIndex        =   4
      Top             =   720
      Width           =   975
   End
   Begin VB.PictureBox Picture1 
      BackColor       =   &H00000000&
      Height          =   855
      Index           =   3
      Left            =   3720
      ScaleHeight     =   795
      ScaleWidth      =   915
      TabIndex        =   3
      Top             =   720
      Width           =   975
   End
   Begin VB.PictureBox Picture1 
      BackColor       =   &H8000000E&
      Height          =   855
      Index           =   2
      Left            =   2760
      ScaleHeight     =   795
      ScaleWidth      =   915
      TabIndex        =   2
      Top             =   720
      Width           =   975
   End
   Begin VB.PictureBox Picture1 
      BackColor       =   &H80000007&
      Height          =   855
      Index           =   1
      Left            =   1800
      ScaleHeight     =   795
      ScaleWidth      =   915
      TabIndex        =   1
      Top             =   720
      Width           =   975
   End
   Begin VB.PictureBox Picture1 
      BackColor       =   &H8000000E&
      BeginProperty DataFormat 
         Type            =   1
         Format          =   ""
         HaveTrueFalseNull=   0
         FirstDayOfWeek  =   0
         FirstWeekOfYear =   0
         LCID            =   16393
         SubFormatType   =   0
      EndProperty
      ForeColor       =   &H8000000D&
      Height          =   855
      Index           =   0
      Left            =   840
      ScaleHeight     =   795
      ScaleWidth      =   915
      TabIndex        =   0
      Top             =   720
      Width           =   975
   End
   Begin ComctlLib.ImageList ImageList1 
      Left            =   120
      Top             =   3840
      _ExtentX        =   1005
      _ExtentY        =   1005
      BackColor       =   -2147483643
      ImageWidth      =   32
      ImageHeight     =   46
      MaskColor       =   12632256
      _Version        =   327682
      BeginProperty Images {0713E8C2-850A-101B-AFC0-4210102A8DA7} 
         NumListImages   =   12
         BeginProperty ListImage1 {0713E8C3-850A-101B-AFC0-4210102A8DA7} 
            Picture         =   "chess.frx":0000
            Key             =   ""
         EndProperty
         BeginProperty ListImage2 {0713E8C3-850A-101B-AFC0-4210102A8DA7} 
            Picture         =   "chess.frx":1192
            Key             =   ""
         EndProperty
         BeginProperty ListImage3 {0713E8C3-850A-101B-AFC0-4210102A8DA7} 
            Picture         =   "chess.frx":2324
            Key             =   ""
         EndProperty
         BeginProperty ListImage4 {0713E8C3-850A-101B-AFC0-4210102A8DA7} 
            Picture         =   "chess.frx":34B6
            Key             =   ""
         EndProperty
         BeginProperty ListImage5 {0713E8C3-850A-101B-AFC0-4210102A8DA7} 
            Picture         =   "chess.frx":4764
            Key             =   ""
         EndProperty
         BeginProperty ListImage6 {0713E8C3-850A-101B-AFC0-4210102A8DA7} 
            Picture         =   "chess.frx":58F6
            Key             =   ""
         EndProperty
         BeginProperty ListImage7 {0713E8C3-850A-101B-AFC0-4210102A8DA7} 
            Picture         =   "chess.frx":6A88
            Key             =   ""
         EndProperty
         BeginProperty ListImage8 {0713E8C3-850A-101B-AFC0-4210102A8DA7} 
            Picture         =   "chess.frx":7C1A
            Key             =   ""
         EndProperty
         BeginProperty ListImage9 {0713E8C3-850A-101B-AFC0-4210102A8DA7} 
            Picture         =   "chess.frx":8DAC
            Key             =   ""
         EndProperty
         BeginProperty ListImage10 {0713E8C3-850A-101B-AFC0-4210102A8DA7} 
            Picture         =   "chess.frx":9F3E
            Key             =   ""
         EndProperty
         BeginProperty ListImage11 {0713E8C3-850A-101B-AFC0-4210102A8DA7} 
            Picture         =   "chess.frx":B0D0
            Key             =   ""
         EndProperty
         BeginProperty ListImage12 {0713E8C3-850A-101B-AFC0-4210102A8DA7} 
            Picture         =   "chess.frx":C262
            Key             =   ""
         EndProperty
      EndProperty
   End
End
Attribute VB_Name = "Form1"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Dim rr(7), rl(7), ru(7), rd(7), bru(7), blu(7), bld(7), brd(7), rrc, rlc, ruc, rdc, bruc, bluc, bldc, brdc, temp1(50), qflag As Integer
Dim bkingloc, wkingloc, pieceflag, knightcheck, saveflag, kingmov(200), kingcnt, pawncheck, tempflag As Integer
Dim startflag, clickflag, mov(200), kill(50), cnt, cnt1, playerflag, temp, previous, kingflag, checkflag, piece(10) As Integer
Dim wl, wr, bl, br, castlel, castler, doublecheck


Private Sub Command1_Click()
startflag = 1
Picture1_Click (1)
End Sub


Public Sub Picture1_Click(index As Integer)

If startflag = 1 Then
     wl = 0
     wr = 0
     bl = 0
     br = 0
     doublecheck = 0
     For i = 0 To cnt - 1
        temp = mov(i)
        row = (temp \ 8)
        If temp Mod 2 = 0 And row Mod 2 = 0 Then
            Picture1(temp).BackColor = &H8000000E
        ElseIf temp Mod 2 = 1 And row Mod 2 = 1 Then
            Picture1(temp).BackColor = &H8000000E
        Else
            Picture1(temp).BackColor = &H80000007
        End If
    Next
    cnt = 0
    cnt1 = 0
    playerflag = 0
    For i = 0 To 63
        Picture1(i).Tag = 0
        Picture1(i).Picture = Nothing
    Next
    For i = 48 To 55
        Picture1(i).Picture = ImageList1.ListImages(1).Picture
        Picture1(i).Tag = 110
    Next
    Picture1(63).Picture = ImageList1.ListImages(2).Picture
    Picture1(56).Picture = ImageList1.ListImages(2).Picture
    Picture1(63).Tag = 120
    Picture1(56).Tag = 120
    Picture1(57).Picture = ImageList1.ListImages(3).Picture
    Picture1(62).Picture = ImageList1.ListImages(3).Picture
    Picture1(57).Tag = 130
    Picture1(62).Tag = 130
    Picture1(58).Picture = ImageList1.ListImages(4).Picture
    Picture1(61).Picture = ImageList1.ListImages(4).Picture
    Picture1(58).Tag = 140
    Picture1(61).Tag = 140
    Picture1(59).Picture = ImageList1.ListImages(5).Picture
    Picture1(59).Tag = 150
    Picture1(60).Picture = ImageList1.ListImages(6).Picture
    Picture1(60).Tag = 160
    wkingloc = 60
    
    For i = 8 To 15
        Picture1(i).Picture = ImageList1.ListImages(7).Picture
        Picture1(i).Tag = 210
    Next
    Picture1(0).Picture = ImageList1.ListImages(8).Picture
    Picture1(7).Picture = ImageList1.ListImages(8).Picture
    Picture1(0).Tag = 220
    Picture1(7).Tag = 220
    Picture1(1).Picture = ImageList1.ListImages(9).Picture
    Picture1(6).Picture = ImageList1.ListImages(9).Picture
    Picture1(1).Tag = 230
    Picture1(6).Tag = 230
    Picture1(2).Picture = ImageList1.ListImages(10).Picture
    Picture1(5).Picture = ImageList1.ListImages(10).Picture
    Picture1(2).Tag = 240
    Picture1(5).Tag = 240
    Picture1(3).Picture = ImageList1.ListImages(11).Picture
    Picture1(3).Tag = 250
    Picture1(4).Picture = ImageList1.ListImages(12).Picture
    Picture1(4).Tag = 260
    bkingloc = 4
    startflag = 0

Else
     For i = 0 To cnt - 1
        temp = mov(i)
        row = (temp \ 8)
        If temp Mod 2 = 0 And row Mod 2 = 0 Then
            Picture1(temp).BackColor = &H8000000E
        ElseIf temp Mod 2 = 1 And row Mod 2 = 1 Then
            Picture1(temp).BackColor = &H8000000E
        Else
            Picture1(temp).BackColor = &H80000007
        End If
    Next
    
    If (Picture1(index).Tag > 100 And Picture1(index).Tag < 200) And playerflag = 0 Then
            If Picture1(previous).Tag = 111 And previous > 47 Then
                Picture1(previous).Tag = 110
            End If
    End If
    
    If Picture1(index).Tag > 200 And playerflag = 1 Then
        If Picture1(previous).Tag = 211 And previous < 16 Then
            Picture1(previous).Tag = 210
        End If
    End If

    For i = 0 To cnt - 1
        If index = mov(i) Then
            uindex = index
            Picture1(index).Picture = Picture1(previous).Picture
            Picture1(index).Tag = Picture1(previous).Tag
            If Picture1(index).Tag = 160 Then
                 wr = 1
                 wl = 1
                 wkingloc = index
                 If castler = 1 Then
                    If index = 62 Then
                        Picture1(61).Picture = Picture1(63).Picture
                         Picture1(61).Tag = Picture1(63).Tag
                         Picture1(63).Picture = Nothing
                         Picture1(63).Tag = 0
                    End If
                End If
                If castlel = 1 Then
                    If index = 58 Then
                        Picture1(59).Picture = Picture1(56).Picture
                         Picture1(59).Tag = Picture1(56).Tag
                         Picture1(56).Picture = Nothing
                         Picture1(56).Tag = 0
                    End If
                End If
            End If
            If Picture1(index).Tag = 260 Then
                 br = 1
                 bl = 1
                 bkingloc = index
                 If castler = 1 Then
                    If index = 6 Then
                        Picture1(5).Picture = Picture1(7).Picture
                         Picture1(5).Tag = Picture1(7).Tag
                         Picture1(7).Picture = Nothing
                         Picture1(7).Tag = 0
                    End If
                End If
                If castlel = 1 Then
                    If index = 2 Then
                        Picture1(3).Picture = Picture1(0).Picture
                         Picture1(3).Tag = Picture1(0).Tag
                         Picture1(0).Picture = Nothing
                         Picture1(0).Tag = 0
                    End If
                End If
            End If
            If playerflag = 0 And (Picture1(previous).Tag = 111 And index < 8) Then
                upgradewhite.Show
                upgradewhite.upwhite (index)
                Form1.Enabled = False
            End If
            If playerflag = 1 And (Picture1(previous).Tag = 211 And index > 55) Then
                upgradeblack.Show
                upgradeblack.upblack (index)
                Form1.Enabled = False
            End If
            If Picture1(index).Tag = 120 Then
                If previous = 63 Then
                    wr = 1
                Else
                    wl = 1
                End If
            End If
            
            If Picture1(index).Tag = 220 Then
                If previous = 63 Then
                    wr = 1
                Else
                    wl = 1
                End If
            End If
            Picture1(previous).Picture = Nothing
            Picture1(previous).Tag = 0
            If playerflag = 0 Then
                playerflag = 1
            Else
                playerflag = 0
            End If
            For j = 0 To 9
            piece(j) = 0
            Next
        End If
    Next
    
    If clickflag = 0 Then
        For i = 0 To 200
            mov(i) = 0
            If i < 50 Then
                kill(i) = 0
            End If
        Next
        qflag = 0
        cnt = 0
        cnt1 = 0
        kingflag = 0
        saveflag = 0
        doublecheck = 0
        If playerflag = 0 Then
            tempflag = 0
            wking (wkingloc)
            For i = 0 To 9
                If piece(i) = 2 Then
                    qflag = qflag + 1
                End If
            Next
            
            If qflag > 1 Then
                doublecheck = 1
            End If
            
            For i = 0 To 9
                If piece(i) = 2 Or doublecheck = 1 Then
                    checkmate
                    tempflag = 1
                    wking (wkingloc)
                    Exit For
                End If
            Next
            If tempflag = 0 Then
                draw
                wking (wkingloc)
            End If
            
            If doublecheck <> 1 Then
            If (Picture1(index).Tag > 109 And Picture1(index).Tag < 120) Then
                saveflag = 1
                t = wpawn(index)
            ElseIf Picture1(index).Tag > 119 And Picture1(index).Tag < 130 Then
                saveflag = 1
                t = wrook(index)
            ElseIf (Picture1(index).Tag > 129 And Picture1(index).Tag < 139) Then
                saveflag = 1
                t = wknight(index)
            ElseIf Picture1(index).Tag > 139 And Picture1(index).Tag < 149 Then
                saveflag = 1
                t = wbishap(index)
            ElseIf Picture1(index).Tag > 149 And Picture1(index).Tag < 159 Then
                saveflag = 1
                t = wbishap(index)
                t = wrook(index)
            End If
            End If
            If Picture1(index).Tag > 159 And Picture1(index).Tag < 169 Then
                kingflag = 1
                wkingmov (index)
            End If
        Else
            tempflag = 0
            bking (bkingloc)
            
            For i = 0 To 9
                If piece(i) = 2 Then
                    qflag = qflag + 1
                End If
            Next
            
            If qflag > 1 Then
                doublecheck = 1
            End If
            
            For i = 0 To 9
                If piece(i) = 2 Or doubleflag = 1 Then
                    checkmate
                    tempflag = 1
                    bking (bkingloc)
                    Exit For
                End If
            Next
            If tempflag = 0 Then
                draw
                bking (bkingloc)
            End If
            If doublecheck <> 1 Then
            If Picture1(index).Tag > 209 And Picture1(index).Tag < 220 Then
                saveflag = 1
                t = bpawn(index)
            ElseIf Picture1(index).Tag > 219 And Picture1(index).Tag < 230 Then
                saveflag = 1
                t = brook(index)
            ElseIf Picture1(index).Tag > 229 And Picture1(index).Tag < 239 Then
                saveflag = 1
                t = bknight(index)
            ElseIf Picture1(index).Tag > 239 And Picture1(index).Tag < 249 Then
                saveflag = 1
                t = bbishap(index)
             ElseIf Picture1(index).Tag > 249 And Picture1(index).Tag < 259 Then
                saveflag = 1
                t = bbishap(index)
                t = brook(index)
            End If
            End If
            If Picture1(index).Tag > 259 And Picture1(index).Tag < 269 Then
                kingflag = 1
                bkingmov (index)
            End If
        End If
        
        For i = 0 To 9
            If piece(i) = 2 And saveflag = 1 Then
               savecheck (index)
           
            End If
        Next
        
        clickflag = 1
    End If
    
    If clickflag = 1 Then  'start of valid moves
        For i = 0 To cnt - 1
            temp = mov(i)
            Picture1(temp).BackColor = &HFFC0C0
        Next
        For i = 0 To cnt1 - 1
            temp = kill(i)
            Picture1(temp).BackColor = &HFF
        Next
        clickflag = 0
        previous = index
    End If 'end of select piece if
    
    
End If 'end of start if

End Sub

Function wpawn(index As Integer)

If Picture1(index).Tag = 110 Then 'start of white pawn
    If Picture1(index - 16).Tag = 0 Then
        If Picture1(index - 8).Tag = 0 And kingflag <> 1 Then
            mov(cnt) = index - 16
            cnt = cnt + 1
        End If
    End If
    Picture1(index).Tag = 111
End If
    row = index \ 8 - 1
    If index - 8 >= 0 Then
    If Picture1(index - 8).Tag = 0 And kingflag <> 1 Then
        mov(cnt) = index - 8
        cnt = cnt + 1
    End If
    End If
    
    If index - 7 >= 0 Then
    If Picture1(index - 7).Tag > 200 Or kingflag = 1 Then
        If ((index - 7) \ 8) = row Then
              mov(cnt) = index - 7
              cnt = cnt + 1
              kill(cnt1) = index - 7
              cnt1 = cnt1 + 1
        End If
    End If
    End If
    
    If index - 9 >= 0 Then
    If Picture1(index - 9).Tag > 200 Or kingflag = 1 Then
        If ((index - 9) \ 8) = row Then
            mov(cnt) = index - 9
            cnt = cnt + 1
            kill(cnt1) = index - 9
            
            cnt1 = cnt1 + 1
        End If
    End If
    End If

disablepawn (index)

End Function


Function bpawn(index As Integer)

If Picture1(index).Tag = 210 Then 'start of Black pawn
    If Picture1(index + 16).Tag = 0 Then
        If Picture1(index + 8).Tag = 0 And kingflag <> 1 Then
            mov(cnt) = index + 16
            cnt = cnt + 1
        End If
    End If
    Picture1(index).Tag = 211
End If
    row = index \ 8
    If index + 8 < 64 Then
    If Picture1(index + 8).Tag = 0 And kingflag <> 1 Then
        mov(cnt) = index + 8
        cnt = cnt + 1
    End If
    End If
    
    If index + 7 < 64 Then
    If (Picture1(index + 7).Tag < 200 And Picture1(index + 7).Tag > 100) Or kingflag = 1 Then
        If (index + 7) \ 8 = row + 1 Then
            mov(cnt) = index + 7
            cnt = cnt + 1
            kill(cnt1) = index + 7
            cnt1 = cnt1 + 1
        End If
    End If
    End If
    
    If index + 9 < 64 Then
    If (Picture1(index + 9).Tag < 200 And Picture1(index + 9).Tag > 100) Or kingflag = 1 Then
        If (index + 9) \ 8 = row + 1 Then
            mov(cnt) = index + 9
            cnt = cnt + 1
            kill(cnt1) = index + 9
            cnt1 = cnt1 + 1
        End If
    End If
    End If

    
disablepawn (index)

End Function


Function wrook(index As Integer)
Dim rookflag, rookcnt1, rookcnt As Integer
rookflag = 0
row = index \ 8
rookcnt = cnt
rookcnt1 = cnt1

i = index
Do While 1
    flag = 0
    If (i + 1) \ 8 = row And (i + 1) < 64 Then
        If Picture1(i + 1).Tag = 0 Or Picture1(i + 1).Tag > 200 Then
            If Picture1(i + 1).Tag > 200 Then
                flag = 1
            End If
            i = i + 1
        Else
            flag = 2
        End If
        If flag <> 2 Then
            If Picture1(i).Tag > 0 Then
                kill(cnt1) = i
                cnt1 = cnt1 + 1
            End If
            mov(cnt) = i
            cnt = cnt + 1
        End If
    End If
    If flag <> 0 Or (i + 1) \ 8 <> row Or i + 1 > 63 Then
        Exit Do
    End If
Loop
i = index
Do While 1
    flag = 0
    If (i - 1) \ 8 = row And (i - 1) >= 0 Then
        If Picture1(i - 1).Tag = 0 Or Picture1(i - 1).Tag > 200 Then
            If Picture1(i - 1).Tag > 200 Then
                flag = 1
            End If
            i = i - 1
        Else
            flag = 2
        End If
        If flag <> 2 Then
            If Picture1(i).Tag > 0 Then
                kill(cnt1) = i
                cnt1 = cnt1 + 1
            End If
            mov(cnt) = i
            cnt = cnt + 1
        End If
    End If
    If flag <> 0 Or (i - 1) \ 8 <> row Or i - 1 < 0 Then
        Exit Do
    End If
Loop
i = index
Do While 1
    flag = 0
    If (i + 8) < 64 Then
        If Picture1(i + 8).Tag = 0 Or Picture1(i + 8).Tag > 200 Then
            If Picture1(i + 8).Tag > 200 Then
                flag = 1
            End If
            i = i + 8
        Else
            flag = 2
        End If
        If flag <> 2 Then
            If Picture1(i).Tag > 0 Then
                kill(cnt1) = i
                cnt1 = cnt1 + 1
            End If
            mov(cnt) = i
            cnt = cnt + 1
        End If
    End If
    If flag <> 0 Or (i + 8) >= 64 Then
        Exit Do
    End If
Loop
i = index
Do While 1
    flag = 0
    If (i - 8) >= 0 Then
        If Picture1(i - 8).Tag = 0 Or Picture1(i - 8).Tag > 200 Then
            If Picture1(i - 8).Tag > 200 Then
                flag = 1
            End If
            i = i - 8
        Else
            flag = 2
        End If
        If flag <> 2 Then
            If Picture1(i).Tag > 0 Then
                kill(cnt1) = i
                cnt1 = cnt1 + 1
            End If
            mov(cnt) = i
            cnt = cnt + 1
        End If
    End If
    If flag <> 0 Or (i - 8) < 0 Then
        Exit Do
    End If
Loop

disable (index)

If pieceflag = 1 And piece(0) = 1 Then
k = 0
rookflag = 1
For i = 0 To cnt - 1
    For j = 0 To rrc - 1
        If mov(i) = rr(j) Then
        temp1(k) = mov(i)
        k = k + 1
        End If
    Next
Next
cnt = k
cnt1 = 1
kill(0) = rr(rrc - 1)
For i = 0 To cnt - 1
mov(i) = temp1(i)
Next
End If

If pieceflag = 2 And piece(1) = 1 Then
k = 0
rookflag = 1
For i = 0 To cnt - 1
    For j = 0 To rlc - 1
        If mov(i) = rl(j) Then
        temp1(k) = mov(i)
        k = k + 1
        End If
    Next
Next
cnt = k
cnt1 = 1
kill(0) = rl(rlc - 1)
For i = 0 To cnt - 1
mov(i) = temp1(i)
Next
End If

If pieceflag = 3 And piece(2) = 1 Then
k = 0
rookflag = 1
For i = 0 To cnt - 1
    For j = 0 To ruc - 1
        If mov(i) = ru(j) Then
        temp1(k) = mov(i)
        k = k + 1
        End If
    Next
Next
cnt = k
cnt1 = 1
kill(0) = ru(ruc - 1)
For i = 0 To cnt - 1
mov(i) = temp1(i)
Next
End If

If pieceflag = 4 And piece(3) = 1 Then
k = 0
rookflag = 1
For i = 0 To cnt - 1
    For j = 0 To rdc - 1
        If mov(i) = rd(j) Then
        temp1(k) = mov(i)
        k = k + 1
        End If
    Next
Next
cnt = k
cnt1 = 1
kill(0) = rd(rdc - 1)
For i = 0 To cnt - 1
mov(i) = temp1(i)
Next
End If
disable (index)
If (pieceflag > 4 And rookflag <> 1) And kingflag <> 1 Then
cnt = rookcnt
cnt1 = rookcnt1
End If
End Function

Function brook(index As Integer)
Dim rookflag, rookcnt, rookcnt1 As Integer
rookflag = 0
rookcnt = cnt
rookcnt1 = cnt1


row = index \ 8
i = index
Do While 1
    flag = 0
    If (i + 1) \ 8 = row And (i + 1) < 64 Then
        If (Picture1(i + 1).Tag > 100 And Picture1(i + 1).Tag < 200) Or Picture1(i + 1).Tag = 0 Then
            If (Picture1(i + 1).Tag > 100 And Picture1(i + 1).Tag < 200) Then
                flag = 1
            End If
            i = i + 1
        Else
            flag = 2
        End If
        If flag <> 2 Then
            If Picture1(i).Tag > 0 Then
                kill(cnt1) = i
                cnt1 = cnt1 + 1
            End If
            mov(cnt) = i
            cnt = cnt + 1
        End If
    End If
    If flag <> 0 Or (i + 1) \ 8 <> row Or i + 1 > 63 Then
        Exit Do
    End If
Loop
i = index
Do While 1
    flag = 0
    If (i - 1) \ 8 = row And (i - 1) >= 0 Then
        If (Picture1(i - 1).Tag > 100 And Picture1(i - 1).Tag < 200) Or Picture1(i - 1).Tag = 0 Then
            If (Picture1(i - 1).Tag > 100 And Picture1(i - 1).Tag < 200) Then
                flag = 1
            End If
            i = i - 1
        Else
            flag = 2
        End If
        If flag <> 2 Then
            If Picture1(i).Tag > 0 Then
                kill(cnt1) = i
                cnt1 = cnt1 + 1
            End If
            mov(cnt) = i
            cnt = cnt + 1
        End If
    End If
    If flag <> 0 Or (i - 1) \ 8 <> row Or i - 1 < 0 Then
        Exit Do
    End If
Loop
i = index
Do While 1
    flag = 0
    If (i + 8) < 64 Then
        If (Picture1(i + 8).Tag > 100 And Picture1(i + 8).Tag < 200) Or Picture1(i + 8).Tag = 0 Then
            If (Picture1(i + 8).Tag > 100 And Picture1(i + 8).Tag < 200) Then
                flag = 1
            End If
            i = i + 8
        Else
            flag = 2
        End If
        If flag <> 2 Then
            If Picture1(i).Tag > 0 Then
                kill(cnt1) = i
                cnt1 = cnt1 + 1
            End If
            mov(cnt) = i
            cnt = cnt + 1
        End If
    End If
    If flag <> 0 Or (i + 8) >= 64 Then
        Exit Do
    End If
Loop
i = index
Do While 1
    flag = 0
    If (i - 8) >= 0 Then
        If (Picture1(i - 8).Tag > 100 And Picture1(i - 8).Tag < 200) Or Picture1(i - 8).Tag = 0 Then
            If (Picture1(i - 8).Tag > 100 And Picture1(i - 8).Tag < 200) Then
                flag = 1
            End If
            i = i - 8
        Else
            flag = 2
        End If
        If flag <> 2 Then
            If Picture1(i).Tag > 0 Then
                kill(cnt1) = i
                cnt1 = cnt1 + 1
            End If
            mov(cnt) = i
            cnt = cnt + 1
        End If
    End If
    If flag <> 0 Or (i - 8) < 0 Then
        Exit Do
    End If
Loop

disable (index)

If pieceflag = 1 And piece(0) = 1 Then
rookflag = 1
k = 0
For i = 0 To cnt - 1
    For j = 0 To rrc - 1
        If mov(i) = rr(j) Then
        temp1(k) = mov(i)
        k = k + 1
        End If
    Next
Next
cnt = k
cnt1 = 1
kill(0) = rr(rrc - 1)
For i = 0 To cnt - 1
mov(i) = temp1(i)
Next
End If

If pieceflag = 2 And piece(1) = 1 Then
rookflag = 1
k = 0
For i = 0 To cnt - 1
    For j = 0 To rlc - 1
        If mov(i) = rl(j) Then
        temp1(k) = mov(i)
        k = k + 1
        End If
    Next
Next
cnt = k
cnt1 = 1
kill(0) = rl(rlc - 1)
For i = 0 To cnt - 1
mov(i) = temp1(i)
Next
End If

If pieceflag = 3 And piece(2) = 1 Then
rookflag = 1
k = 0
For i = 0 To cnt - 1
    For j = 0 To ruc - 1
        If mov(i) = ru(j) Then
        temp1(k) = mov(i)
        k = k + 1
        End If
    Next
Next
cnt = k
cnt1 = 1
kill(0) = ru(ruc - 1)
For i = 0 To cnt - 1
mov(i) = temp1(i)
Next
End If

If pieceflag = 4 And piece(3) = 1 Then
rookflag = 1
k = 0
For i = 0 To cnt - 1
    For j = 0 To rdc - 1
        If mov(i) = rd(j) Then
        temp1(k) = mov(i)
        k = k + 1
        End If
    Next
Next
cnt = k
cnt1 = 1
kill(0) = rd(rdc - 1)
For i = 0 To cnt - 1
mov(i) = temp1(i)
Next
End If
disable (index)

If (pieceflag > 4 And rookflag <> 1) And kingflag <> 1 Then
cnt = rookcnt
cnt1 = rookcnt1
End If
End Function

Function wknight(index As Integer)

disable (index)

If pieceflag > 0 Then
For i = 0 To 9
    If piece(pieceflag - 1) = 1 Then
       Exit Function
     End If
Next
End If

row = index \ 8
i = index

If (i + 6) \ 8 = (row + 1) And (i + 6) < 64 Then
    If Picture1(i + 6).Tag = 0 Or Picture1(i + 6).Tag > 200 Then
        If Picture1(i + 6).Tag > 200 Then
            kill(cnt1) = i + 6
            cnt1 = cnt1 + 1
        End If
        mov(cnt) = i + 6
        cnt = cnt + 1
    End If
End If

If (i + 10) \ 8 = (row + 1) And (i + 10) < 64 Then
    If Picture1(i + 10).Tag = 0 Or Picture1(i + 10).Tag > 200 Then
        If Picture1(i + 10).Tag > 200 Then
            kill(cnt1) = i + 10
            cnt1 = cnt1 + 1
        End If
        mov(cnt) = i + 10
        cnt = cnt + 1
    End If
End If

If (i - 6) \ 8 = (row - 1) And (i - 6) >= 0 Then
    If Picture1(i - 6).Tag = 0 Or Picture1(i - 6).Tag > 200 Then
        If Picture1(i - 6).Tag > 200 Then
            kill(cnt1) = i - 6
            cnt1 = cnt1 + 1
        End If
        mov(cnt) = i - 6
        cnt = cnt + 1
    End If
End If

If (i - 10) \ 8 = (row - 1) And (i - 10) >= 0 Then
    If Picture1(i - 10).Tag = 0 Or Picture1(i - 10).Tag > 200 Then
        If Picture1(i - 10).Tag > 200 Then
            kill(cnt1) = i - 10
            cnt1 = cnt1 + 1
        End If
        mov(cnt) = i - 10
        cnt = cnt + 1
    End If
End If

If (i + 15) \ 8 = (row + 2) And (i + 15) < 64 Then
    If Picture1(i + 15).Tag = 0 Or Picture1(i + 15).Tag > 200 Then
        If Picture1(i + 15).Tag > 200 Then
            kill(cnt1) = i + 15
            cnt1 = cnt1 + 1
        End If
        mov(cnt) = i + 15
        cnt = cnt + 1
    End If
End If

If (i + 17) \ 8 = (row + 2) And (i + 17) < 64 Then
    If Picture1(i + 17).Tag = 0 Or Picture1(i + 17).Tag > 200 Then
        If Picture1(i + 17).Tag > 200 Then
            kill(cnt1) = i + 17
            cnt1 = cnt1 + 1
        End If
        mov(cnt) = i + 17
        cnt = cnt + 1
    End If
End If

If (i - 15) \ 8 = (row - 2) And (i - 15) >= 0 Then
    If Picture1(i - 15).Tag = 0 Or Picture1(i - 15).Tag > 200 Then
        If Picture1(i - 15).Tag > 200 Then
            kill(cnt1) = i - 15
            cnt1 = cnt1 + 1
        End If
        mov(cnt) = i - 15
        cnt = cnt + 1
    End If
End If

If (i - 17) \ 8 = (row - 2) And (i - 17) >= 0 Then
    If Picture1(i - 17).Tag = 0 Or Picture1(i - 17).Tag > 200 Then
        If Picture1(i - 17).Tag > 200 Then
            kill(cnt1) = i - 17
            cnt1 = cnt1 + 1
        End If
        mov(cnt) = i - 17
        cnt = cnt + 1
    End If
End If

End Function

Function bknight(index As Integer)

disable (index)

If pieceflag > 0 Then
For i = 0 To 9
    If piece(pieceflag - 1) = 1 Then
       Exit Function
     End If
Next
End If

row = index \ 8
i = index

If (i + 6) \ 8 = (row + 1) And (i + 6) < 64 Then
    If Picture1(i + 6).Tag = 0 Or (Picture1(i + 6).Tag > 100 And Picture1(i + 6).Tag < 200) Then
        If (Picture1(i + 6).Tag > 100 And Picture1(i + 6).Tag < 200) Then
            kill(cnt1) = i + 6
            cnt1 = cnt1 + 1
        End If
        mov(cnt) = i + 6
        cnt = cnt + 1
    End If
End If

If (i + 10) \ 8 = (row + 1) And (i + 10) < 64 Then
    If Picture1(i + 10).Tag = 0 Or (Picture1(i + 10).Tag > 100 And Picture1(i + 10).Tag < 200) Then
        If (Picture1(i + 10).Tag > 100 And Picture1(i + 10).Tag < 200) Then
            kill(cnt1) = i + 10
            cnt1 = cnt1 + 1
        End If
        mov(cnt) = i + 10
        cnt = cnt + 1
    End If
End If

If (i - 6) \ 8 = (row - 1) And (i - 6) >= 0 Then
    If Picture1(i - 6).Tag = 0 Or (Picture1(i - 6).Tag > 100 And Picture1(i - 6).Tag < 200) Then
        If (Picture1(i - 6).Tag > 100 And Picture1(i - 6).Tag < 200) Then
            kill(cnt1) = i - 6
            cnt1 = cnt1 + 1
        End If
        mov(cnt) = i - 6
        cnt = cnt + 1
    End If
End If

If (i - 10) \ 8 = (row - 1) And (i - 10) >= 0 Then
    If Picture1(i - 10).Tag = 0 Or (Picture1(i - 10).Tag > 100 And Picture1(i - 10).Tag < 200) Then
        If (Picture1(i - 10).Tag > 100 And Picture1(i - 10).Tag < 200) Then
            kill(cnt1) = i - 10
            cnt1 = cnt1 + 1
        End If
        mov(cnt) = i - 10
        cnt = cnt + 1
    End If
End If

If (i + 15) \ 8 = (row + 2) And (i + 15) < 64 Then
    If Picture1(i + 15).Tag = 0 Or (Picture1(i + 15).Tag > 100 And Picture1(i + 15).Tag < 200) Then
        If (Picture1(i + 15).Tag > 100 And Picture1(i + 15).Tag < 200) Then
            kill(cnt1) = i + 15
            cnt1 = cnt1 + 1
        End If
        mov(cnt) = i + 15
        cnt = cnt + 1
    End If
End If

If (i + 17) \ 8 = (row + 2) And (i + 17) < 64 Then
    If Picture1(i + 17).Tag = 0 Or (Picture1(i + 17).Tag > 100 And Picture1(i + 17).Tag < 200) Then
        If (Picture1(i + 17).Tag > 100 And Picture1(i + 17).Tag < 200) Then
            kill(cnt1) = i + 17
            cnt1 = cnt1 + 1
        End If
        mov(cnt) = i + 17
        cnt = cnt + 1
    End If
End If

If (i - 15) \ 8 = (row - 2) And (i - 15) >= 0 Then
    If Picture1(i - 15).Tag = 0 Or (Picture1(i - 15).Tag > 100 And Picture1(i - 15).Tag < 200) Then
        If (Picture1(i - 15).Tag > 100 And Picture1(i - 15).Tag < 200) Then
            kill(cnt1) = i - 15
            cnt1 = cnt1 + 1
        End If
        mov(cnt) = i - 15
        cnt = cnt + 1
    End If
End If

If (i - 17) \ 8 = (row - 2) And (i - 17) >= 0 Then
    If Picture1(i - 17).Tag = 0 Or (Picture1(i - 17).Tag > 100 And Picture1(i - 17).Tag < 200) Then
        If (Picture1(i - 17).Tag > 100 And Picture1(i - 17).Tag < 200) Then
            kill(cnt1) = i - 17
            cnt1 = cnt1 + 1
        End If
        mov(cnt) = i - 17
        cnt = cnt + 1
    End If
End If

End Function

Function wbishap(index As Integer)
Dim bishopflag As Integer
bishopflag = 0

inc = 1
row = index \ 8
i = index
Do While 1
    flag = 0
    If (i + inc * 7) \ 8 = (inc + row) And (i + inc * 7) < 64 Then
        If Picture1(i + inc * 7).Tag = 0 Or Picture1(i + inc * 7).Tag > 200 Then
            If Picture1(i + inc * 7).Tag > 200 Then
                flag = 1
            End If
        Else
            flag = 2
        End If
        If flag <> 2 Then
            If Picture1(i + inc * 7).Tag > 0 Then
                kill(cnt1) = i + inc * 7
                cnt1 = cnt1 + 1
            End If
            mov(cnt) = i + inc * 7
            cnt = cnt + 1
        End If
    End If
    If flag <> 0 Or (i + inc * 7) \ 8 <> (row + inc) Then
        Exit Do
    End If
    inc = inc + 1
Loop

inc = 1
i = index
Do While 1
    flag = 0
    If (i + inc * 9) \ 8 = (inc + row) And (i + inc * 9) < 64 Then
        If Picture1(i + inc * 9).Tag = 0 Or Picture1(i + inc * 9).Tag > 200 Then
            If Picture1(i + inc * 9).Tag > 200 Then
                flag = 1
            End If
        Else
            flag = 2
        End If
        If flag <> 2 Then
            If Picture1(i + inc * 9).Tag > 0 Then
                kill(cnt1) = i + inc * 9
                cnt1 = cnt1 + 1
            End If
            mov(cnt) = i + inc * 9
            cnt = cnt + 1
        End If
    End If
    If flag <> 0 Or (i + inc * 9) \ 8 <> (row + inc) Then
        Exit Do
    End If
    inc = inc + 1
Loop

inc = 1
i = index
Do While 1
    flag = 0
    If (i - inc * 7) \ 8 = (row - inc) And (i - inc * 7) >= 0 Then
        If Picture1(i - inc * 7).Tag = 0 Or Picture1(i - inc * 7).Tag > 200 Then
            If Picture1(i - inc * 7).Tag > 200 Then
                flag = 1
            End If
        Else
            flag = 2
        End If
        If flag <> 2 Then
            If Picture1(i - inc * 7).Tag > 0 Then
                kill(cnt1) = i - inc * 7
                cnt1 = cnt1 + 1
            End If
            mov(cnt) = i - inc * 7
            cnt = cnt + 1
        End If
    End If
    If flag <> 0 Or (i - inc * 7) \ 8 <> (row - inc) Then
        Exit Do
    End If
    inc = inc + 1
Loop

inc = 1
i = index
Do While 1
    flag = 0
    If (i - inc * 9) \ 8 = (row - inc) And (i - inc * 9) >= 0 Then
        If Picture1(i - inc * 9).Tag = 0 Or Picture1(i - inc * 9).Tag > 200 Then
            If Picture1(i - inc * 9).Tag > 200 Then
                flag = 1
            End If
        Else
            flag = 2
        End If
        If flag <> 2 Then
            If Picture1(i - inc * 9).Tag > 0 Then
                kill(cnt1) = i - inc * 9
                cnt1 = cnt1 + 1
            End If
            mov(cnt) = i - inc * 9
            cnt = cnt + 1
        End If
    End If
    If flag <> 0 Or (i - inc * 9) \ 8 <> (row - inc) Then
        Exit Do
    End If
    inc = inc + 1
Loop

disable (index)

If piece(4) = 1 And pieceflag = 5 Then
k = 0
bishopflag = 1
For i = 0 To cnt - 1
    For j = 0 To bldc - 1
        If mov(i) = bld(j) Then
        temp1(k) = mov(i)
        k = k + 1
        End If
    Next
Next
cnt = k
cnt1 = 1
kill(0) = bld(bldc - 1)
For i = 0 To cnt - 1
mov(i) = temp1(i)
Next
End If

If piece(5) = 1 And pieceflag = 6 Then
k = 0
bishopflag = 1
For i = 0 To cnt - 1
    For j = 0 To brdc - 1
        If mov(i) = brd(j) Then
        temp1(k) = mov(i)
        k = k + 1
        End If
    Next
Next
cnt = k
cnt1 = 1
kill(0) = brd(brdc - 1)
For i = 0 To cnt - 1
mov(i) = temp1(i)
Next
End If

If piece(6) = 1 And pieceflag = 7 Then
k = 0
bishopflag = 1
For i = 0 To cnt - 1
    For j = 0 To bluc - 1
        If mov(i) = blu(j) Then
        temp1(k) = mov(i)
        k = k + 1
        End If
    Next
Next
cnt = k
cnt1 = 1
kill(0) = blu(bluc - 1)
For i = 0 To cnt - 1
mov(i) = temp1(i)
Next
End If

If piece(7) = 1 And pieceflag = 8 Then
k = 0
bishopflag = 1
For i = 0 To cnt - 1
    For j = 0 To bruc - 1
        If mov(i) = bru(j) Then
        temp1(k) = mov(i)
        k = k + 1
        End If
    Next
Next
cnt = k
cnt1 = 1
kill(0) = bru(bruc - 1)
For i = 0 To cnt - 1
mov(i) = temp1(i)
Next
End If

If ((pieceflag < 5 And pieceflag > 0) And bishopflag <> 1) And kingflag <> 1 Then
cnt = 0
cnt1 = 0
End If

End Function

Function bbishap(index As Integer)
Dim bishopflag As Integer
bishopflag = 0

inc = 1
row = index \ 8
i = index
Do While 1
    flag = 0
    If (i + inc * 7) \ 8 = (inc + row) And (i + inc * 7) < 64 Then
        If Picture1(i + inc * 7).Tag = 0 Or (Picture1(i + inc * 7).Tag > 100 And Picture1(i + inc * 7).Tag < 200) Then
            If (Picture1(i + inc * 7).Tag > 100 And Picture1(i + inc * 7).Tag < 200) Then
                flag = 1
            End If
        Else
            flag = 2
        End If
        If flag <> 2 Then
            If Picture1(i + inc * 7).Tag > 0 Then
                kill(cnt1) = i + inc * 7
                cnt1 = cnt1 + 1
            End If
            mov(cnt) = i + inc * 7
            cnt = cnt + 1
        End If
    End If
    If flag <> 0 Or (i + inc * 7) \ 8 <> (row + inc) Then
        Exit Do
    End If
    inc = inc + 1
Loop

inc = 1
i = index
Do While 1
    flag = 0
    If (i + inc * 9) \ 8 = (inc + row) And (i + inc * 9) < 64 Then
        If Picture1(i + inc * 9).Tag = 0 Or (Picture1(i + inc * 9).Tag > 100 And Picture1(i + inc * 9).Tag < 200) Then
            If (Picture1(i + inc * 9).Tag > 100 And Picture1(i + inc * 9).Tag < 200) Then
                flag = 1
            End If
        Else
            flag = 2
        End If
        If flag <> 2 Then
            If Picture1(i + inc * 9).Tag > 0 Then
                kill(cnt1) = i + inc * 9
                cnt1 = cnt1 + 1
            End If
            mov(cnt) = i + inc * 9
            cnt = cnt + 1
        End If
    End If
    If flag <> 0 Or (i + inc * 9) \ 8 <> (row + inc) Then
        Exit Do
    End If
    inc = inc + 1
Loop

inc = 1
i = index
Do While 1
    flag = 0
    If (i - inc * 7) \ 8 = (row - inc) And (i - inc * 7) >= 0 Then
        If Picture1(i - inc * 7).Tag = 0 Or (Picture1(i - inc * 7).Tag > 100 And Picture1(i - inc * 7).Tag < 200) Then
            If (Picture1(i - inc * 7).Tag > 100 And Picture1(i - inc * 7).Tag < 200) Then
                flag = 1
            End If
        Else
            flag = 2
        End If
        If flag <> 2 Then
            If Picture1(i - inc * 7).Tag > 0 Then
                kill(cnt1) = i - inc * 7
                cnt1 = cnt1 + 1
            End If
            mov(cnt) = i - inc * 7
            cnt = cnt + 1
        End If
    End If
    If flag <> 0 Or (i - inc * 7) \ 8 <> (row - inc) Then
        Exit Do
    End If
    inc = inc + 1
Loop

inc = 1
i = index
Do While 1
    flag = 0
    If (i - inc * 9) \ 8 = (row - inc) And (i - inc * 9) >= 0 Then
        If Picture1(i - inc * 9).Tag = 0 Or (Picture1(i - inc * 9).Tag > 100 And Picture1(i - inc * 9).Tag < 200) Then
            If (Picture1(i - inc * 9).Tag > 100 And Picture1(i - inc * 9).Tag < 200) Then
                flag = 1
            End If
        Else
            flag = 2
        End If
        If flag <> 2 Then
            If Picture1(i - inc * 9).Tag > 0 Then
                kill(cnt1) = i - inc * 9
                cnt1 = cnt1 + 1
            End If
            mov(cnt) = i - inc * 9
            cnt = cnt + 1
        End If
    End If
    If flag <> 0 Or (i - inc * 9) \ 8 <> (row - inc) Then
        Exit Do
    End If
    inc = inc + 1
Loop

disable (index)

If piece(4) = 1 And pieceflag = 5 Then
bishopflag = 1
k = 0
For i = 0 To cnt - 1
    For j = 0 To bldc - 1
        If mov(i) = bld(j) Then
        temp1(k) = mov(i)
        k = k + 1
        End If
    Next
Next
cnt = k
cnt1 = 1
kill(0) = bld(bldc - 1)
For i = 0 To cnt - 1
mov(i) = temp1(i)
Next
End If

If piece(5) = 1 And pieceflag = 6 Then
bishopflag = 1
k = 0
For i = 0 To cnt - 1
    For j = 0 To brdc - 1
        If mov(i) = brd(j) Then
        temp1(k) = mov(i)
        k = k + 1
        End If
    Next
Next
cnt = k
cnt1 = 1
kill(0) = brd(brdc - 1)
For i = 0 To cnt - 1
mov(i) = temp1(i)
Next
End If

If piece(6) = 1 And pieceflag = 7 Then
bishopflag = 1
k = 0
For i = 0 To cnt - 1
    For j = 0 To bluc - 1
        If mov(i) = blu(j) Then
        temp1(k) = mov(i)
        k = k + 1
        End If
    Next
Next
cnt = k
cnt1 = 1
kill(0) = blu(bluc - 1)
For i = 0 To cnt - 1
mov(i) = temp1(i)
Next
End If

If piece(7) = 1 And pieceflag = 8 Then
bishopflag = 1
k = 0
For i = 0 To cnt - 1
    For j = 0 To bruc - 1
        If mov(i) = bru(j) Then
        temp1(k) = mov(i)
        k = k + 1
        End If
    Next
Next
cnt = k
cnt1 = 1
kill(0) = bru(bruc - 1)
For i = 0 To cnt - 1
mov(i) = temp1(i)
Next
End If


disable (index)

If ((pieceflag < 5 And pieceflag > 0) And bishopflag <> 1) And kingflag <> 1 Then
cnt = 0
cnt1 = 0
End If


End Function
 
Function wking(index As Integer)
Dim i As Integer
For i = 0 To 9
    piece(i) = 0
Next
cnt = 0
cnt1 = 0
wknight (index)
For i = 0 To cnt1 - 1
   If Picture1(kill(i)).Tag = 230 Then
        piece(8) = 2
        knightcheck = kill(i)
        Exit For
    End If
Next

cnt = 0
cnt1 = 0

wpawn (index)
For i = 0 To cnt1 - 1
   If Picture1(kill(i)).Tag = 210 Or Picture1(kill(i)).Tag = 211 Then
        piece(9) = 2
        pawncheck = kill(i)
        Exit For
    End If
Next
cnt = 0
cnt1 = 0



bflag = 0
cntw = 0
wpindex = -10
rrc = 0
row = index \ 8
i = index

Do While 1
    flag = 0
    If (i + 1) \ 8 = row And (i + 1) < 64 Then
         If Picture1(i + 1).Tag > 100 And Picture1(i + 1).Tag < 200 Then
             If Picture1(i + 1).Tag = 120 Or Picture1(i + 1).Tag = 150 Then
                wpindex = i + 1
                cntw = cntw + 1
             Else
                cntw = cntw + 1
            End If
         End If
         If Picture1(i + 1).Tag > 200 Then
             bflag = 1
             bpindex = i + 1
             rr(rrc) = i + 1
             rrc = rrc + 1
            Exit Do
         End If
         If cntw = 2 Then
             Exit Do
         End If
         rr(rrc) = i + 1
         rrc = rrc + 1
         i = i + 1
     Else
     Exit Do
     End If
     
Loop

If cntw = 2 Then
rrc = 0
End If
If bflag = 1 And cntw = 1 Then
   If Picture1(bpindex).Tag = 220 Or Picture1(bpindex).Tag = 250 Then
      piece(0) = 1
    Else
      rrc = 0
   End If
   
End If
If bflag = 1 And cntw = 0 Then
   If Picture1(bpindex).Tag = 220 Or Picture1(bpindex).Tag = 250 Then
     checkflag = 1
     piece(0) = 2
   End If

End If


bflag = 0
cntw = 0
rlc = 0
wpindex = -10
row = index \ 8
i = index
Do While 1
    flag = 0
    If (i - 1) \ 8 = row And (i - 1) >= 0 Then
       If Picture1(i - 1).Tag > 100 And Picture1(i - 1).Tag < 200 Then
         If Picture1(i - 1).Tag = 120 Or Picture1(i - 1).Tag = 150 Then
             wpindex = i - 1
             cntw = cntw + 1
         Else
              cntw = cntw + 1
         End If
       End If
       If Picture1(i - 1).Tag > 200 Then
             bflag = 1
             bpindex = i - 1
             rl(rlc) = i - 1
             rlc = rlc + 1
            Exit Do
         End If
         If cntw = 2 Then
             Exit Do
         End If
         rl(rlc) = i - 1
         rlc = rlc + 1
         i = i - 1
     Else
     Exit Do
     End If
Loop

If cntw = 2 Then
rlc = 0
End If
If bflag = 1 And cntw = 1 Then
   If Picture1(bpindex).Tag = 220 Or Picture1(bpindex).Tag = 250 Then
      piece(1) = 1
    Else
      rlc = 0
   End If
End If
If bflag = 1 And cntw = 0 Then
   If Picture1(bpindex).Tag = 220 Or Picture1(bpindex).Tag = 250 Then
    checkflag = 1
     piece(1) = 2
   End If
End If


bflag = 0
cntw = 0
wpindex = -10
rdc = 0
i = index

Do While 1
    flag = 0
    If (i + 8) < 64 Then
       If Picture1(i + 8).Tag > 100 And Picture1(i + 8).Tag < 200 Then
         If Picture1(i + 8).Tag = 120 Or Picture1(i + 8).Tag = 150 Then
             wpindex = i + 8
             cntw = cntw + 1
         Else
             cntw = cntw + 1
         End If
      End If
      If Picture1(i + 8).Tag > 200 Then
             bflag = 1
             bpindex = i + 8
             rd(rdc) = i + 8
             rdc = rdc + 1
            Exit Do
         End If
         If cntw = 2 Then
             Exit Do
         End If
         rd(rdc) = i + 8
         rdc = rdc + 1
         i = i + 8
     Else
     Exit Do
     End If
Loop

If cntw = 2 Then
rdc = 0
End If
If bflag = 1 And cntw = 1 Then
   If Picture1(bpindex).Tag = 220 Or Picture1(bpindex).Tag = 250 Then
    piece(3) = 1
   Else
      rdc = 0
   End If
End If
If bflag = 1 And cntw = 0 Then
   If Picture1(bpindex).Tag = 220 Or Picture1(bpindex).Tag = 250 Then
    checkflag = 1
     piece(3) = 2
   End If
End If

bflag = 0
cntw = 0
wpindex = -10
ruc = 0
i = index
Do While 1
    flag = 0
    If (i - 8) \ 8 >= 0 And i - 8 >= 0 Then
       If Picture1(i - 8).Tag > 110 And Picture1(i - 8).Tag < 200 Then
         If Picture1(i - 8).Tag = 120 Or Picture1(i - 8).Tag = 150 Then
             wpindex = i - 8
             cntw = cntw + 1
         Else
              cntw = cntw + 1
         End If
       End If
       If Picture1(i - 8).Tag > 200 Then
             bflag = 1
             bpindex = i - 8
             ru(ruc) = i - 8
             ruc = ruc + 1
            Exit Do
         End If
         If cntw = 2 Then
             Exit Do
         End If
         ru(ruc) = i - 8
         ruc = ruc + 1
         i = i - 8
     Else
     Exit Do
     End If
Loop

If cntw = 2 Then
ruc = 0
End If

If bflag = 1 And cntw = 1 Then
   If Picture1(bpindex).Tag = 220 Or Picture1(bpindex).Tag = 250 Then
    piece(2) = 1
  Else
      ruc = 0
   End If
End If

If bflag = 1 And cntw = 0 Then
   If Picture1(bpindex).Tag = 220 Or Picture1(bpindex).Tag = 250 Then
     checkflag = 1
     piece(2) = 2
   End If
End If

                  'Bishop

bflag = 0
cntw = 0
wpindex = -10
bldc = 0
inc = 1
row = index \ 8
i = index
Do While 1
    flag = 0
    If (i + inc * 7) \ 8 = (inc + row) And (i + inc * 7) < 64 Then
      If (Picture1(i + inc * 7).Tag > 100 And Picture1(i + inc * 7).Tag < 200) Then
        If (Picture1(i + inc * 7).Tag = 140 Or Picture1(i + inc * 7).Tag = 150) Then
            wpindex = i + inc * 7
            cntw = cntw + 1
        Else
            cntw = cntw + 1
        End If
      End If
      If Picture1(i + inc * 7).Tag > 200 Then
             bflag = 1
             bpindex = i + inc * 7
             bld(bldc) = i + inc * 7
             bldc = bldc + 1
             Exit Do
        End If
        If cntw = 2 Then
             Exit Do
        End If
        bld(bldc) = i + inc * 7
        bldc = bldc + 1
        inc = inc + 1
  Else
     Exit Do
  End If
Loop

If cntw = 2 Then
bldc = 0
End If
If bflag = 1 And cntw = 1 Then
   If Picture1(bpindex).Tag = 240 Or Picture1(bpindex).Tag = 250 Then
      piece(4) = 1
   Else
      bldc = 0
   End If

End If
If bflag = 1 And cntw = 0 Then
   If Picture1(bpindex).Tag = 240 Or Picture1(bpindex).Tag = 250 Then
     checkflag = 1
     piece(4) = 2
   End If
End If

bflag = 0
cntw = 0
wpindex = -10
brdc = 0
inc = 1
row = index \ 8
i = index
Do While 1
    flag = 0
    If (i + inc * 9) \ 8 = (inc + row) And (i + inc * 9) < 64 Then
      If (Picture1(i + inc * 9).Tag > 100 And Picture1(i + inc * 9).Tag < 200) Then
        If (Picture1(i + inc * 9).Tag = 140 Or Picture1(i + inc * 9).Tag = 150) Then
            wpindex = i + inc * 9
            cntw = cntw + 1
        Else
            cntw = cntw + 1
        End If
      End If
      If Picture1(i + inc * 9).Tag > 200 Then
             bflag = 1
             bpindex = i + inc * 9
             brd(brdc) = i + inc * 9
             brdc = brdc + 1
            Exit Do
        End If
        If cntw = 2 Then
             Exit Do
        End If
        brd(brdc) = i + inc * 9
        brdc = brdc + 1
        inc = inc + 1
  Else
     Exit Do
  End If
Loop

If cntw = 2 Then
brdc = 0
End If
If bflag = 1 And cntw = 1 Then
   If Picture1(bpindex).Tag = 240 Or Picture1(bpindex).Tag = 250 Then
     piece(5) = 1
   Else
      brdc = 0
   End If
   
End If
If bflag = 1 And cntw = 0 Then
   If Picture1(bpindex).Tag = 240 Or Picture1(bpindex).Tag = 250 Then
    checkflag = 1
     piece(5) = 2
   End If
End If


bflag = 0
cntw = 0
wpindex = -10
bluc = 0
inc = 1
row = index \ 8
i = index
Do While 1
    flag = 0
    If (i - inc * 9) \ 8 = (row - inc) And (i - inc * 9) >= 0 Then
      If (Picture1(i - inc * 9).Tag > 100 And Picture1(i - inc * 9).Tag < 200) Then
        If (Picture1(i - inc * 9).Tag = 140 Or Picture1(i - inc * 9).Tag = 150) Then
            wpindex = i - inc * 9
            cntw = cntw + 1
        Else
            cntw = cntw + 1
        End If
      End If
      If Picture1(i - inc * 9).Tag > 200 Then
             bflag = 1
             bpindex = i - inc * 9
             blu(bluc) = i - inc * 9
             bluc = bluc + 1
            Exit Do
        End If
        If cntw = 2 Then
             Exit Do
        End If
        blu(bluc) = i - inc * 9
        bluc = bluc + 1
        inc = inc + 1
  Else
     Exit Do
  End If
Loop

If cntw = 2 Then
bluc = 0
End If
If bflag = 1 And cntw = 1 Then
   If Picture1(bpindex).Tag = 240 Or Picture1(bpindex).Tag = 250 Then
     piece(6) = 1
    Else
      bluc = 0
   End If
   
End If
If bflag = 1 And cntw = 0 Then
   If Picture1(bpindex).Tag = 240 Or Picture1(bpindex).Tag = 250 Then
     checkflag = 1
     piece(6) = 2
   End If
End If

bflag = 0
cntw = 0
wpindex = -10
bruc = 0
inc = 1
row = index \ 8
i = index
Do While 1
    flag = 0
    If (i - inc * 7) \ 8 = (row - inc) And (i - inc * 7) >= 0 Then
      If (Picture1(i - inc * 7).Tag > 100 And Picture1(i - inc * 7).Tag < 200) Then
        If (Picture1(i - inc * 7).Tag = 140 Or Picture1(i - inc * 7).Tag = 150) Then
            wpindex = i - inc * 7
            cntw = cntw + 1
        Else
            cntw = cntw + 1
        End If
      End If
     If Picture1(i - inc * 7).Tag > 200 Then
             bflag = 1
             bpindex = i - inc * 7
             bru(bruc) = i - inc * 7
             bruc = bruc + 1
            Exit Do
        End If
        If cntw = 2 Then
             Exit Do
        End If
        bru(bruc) = i - inc * 7
        bruc = bruc + 1
        inc = inc + 1
  Else
     Exit Do
  End If
Loop

If cntw = 2 Then
bruc = 0
End If
If bflag = 1 And cntw = 1 Then
   If Picture1(bpindex).Tag = 240 Or Picture1(bpindex).Tag = 250 Then
     piece(7) = 1
     If wpindex = -10 Then
      qflag = 2
    End If
   Else
      bruc = 0
   End If
   
End If
If bflag = 1 And cntw = 0 Then
   If Picture1(bpindex).Tag = 240 Or Picture1(bpindex).Tag = 250 Then
    checkflag = 1
     piece(7) = 2
   End If
End If
cnt1 = 0
cnt = 0

End Function


Function bking(index As Integer)

Dim i As Integer

For i = 0 To 9
    piece(i) = 0
Next

cnt = 0
cnt1 = 0

bknight (index)

For i = 0 To cnt1 - 1
   If Picture1(kill(i)).Tag = 130 Then
        piece(8) = 2
        knightcheck = kill(i)
        Exit For
    End If
Next

cnt = 0
cnt1 = 0
bpawn (index)
For i = 0 To cnt1 - 1
   If Picture1(kill(i)).Tag = 110 Or Picture1(kill(i)).Tag = 111 Then
        piece(9) = 2
        pawncheck = kill(i)
        Exit For
    End If
Next
cnt = 0
cnt1 = 0


bflag = 0
cntw = 0
wpindex = -10
rrc = 0
row = index \ 8
i = index

Do While 1
    flag = 0
    If (i + 1) \ 8 = row And (i + 1) < 64 Then
       If Picture1(i + 1).Tag > 200 Then
         If Picture1(i + 1).Tag = 220 Or Picture1(i + 1).Tag = 250 Then
             wpindex = i + 1
             cntw = cntw + 1
         Else
             cntw = cntw + 1
         End If
      End If
      If Picture1(i + 1).Tag > 100 And Picture1(i + 1).Tag < 200 Then
             bflag = 1
             bpindex = i + 1
             rr(rrc) = i + 1
             rrc = rrc + 1
            Exit Do
         End If
         If cntw = 2 Then
             Exit Do
         End If
         rr(rrc) = i + 1
         rrc = rrc + 1
         i = i + 1
     Else
     Exit Do
     End If
     
Loop

If cntw = 2 Then
rrc = 0
End If
If bflag = 1 And cntw = 1 Then
   If Picture1(bpindex).Tag = 120 Or Picture1(bpindex).Tag = 150 Then
    piece(0) = 1
   Else
     rrc = 0
   End If
   
End If
If bflag = 1 And cntw = 0 Then
   If Picture1(bpindex).Tag = 120 Or Picture1(bpindex).Tag = 150 Then
     checkflag = 1
     piece(0) = 2
   End If
End If

bflag = 0
cntw = 0
rlc = 0
wpindex = -10
row = index \ 8
i = index
Do While 1
    flag = 0
    If (i - 1) \ 8 = row And (i - 1) >= 0 Then
       If Picture1(i - 1).Tag > 200 Then
         If Picture1(i - 1).Tag = 220 Or Picture1(i - 1).Tag = 250 Then
             wpindex = i - 1
             cntw = cntw + 1
         Else
             cntw = cntw + 1
         End If
       End If
       If Picture1(i - 1).Tag > 100 And Picture1(i - 1).Tag < 200 Then
             bflag = 1
             bpindex = i - 1
             rl(rlc) = i - 1
             rlc = rlc + 1
            Exit Do
         End If
         If cntw = 2 Then
             Exit Do
         End If
         rl(rlc) = i - 1
         rlc = rlc + 1
         i = i - 1
     Else
     Exit Do
     End If
Loop

If cntw = 2 Then
rlc = 0
End If
If bflag = 1 And cntw = 1 Then
   If Picture1(bpindex).Tag = 120 Or Picture1(bpindex).Tag = 150 Then
    piece(1) = 1
  Else
      rlc = 0
   End If
   
End If
If bflag = 1 And cntw = 0 Then
   If Picture1(bpindex).Tag = 120 Or Picture1(bpindex).Tag = 150 Then
    checkflag = 1
     piece(1) = 2
   End If
End If


bflag = 0
cntw = 0
wpindex = -10
ruc = 0
row = index \ 8
i = index
Do While 1
    flag = 0
    If (i + 8) \ 8 = row + 1 And row + 1 < 8 Then
       row = row + 1
       If Picture1(i + 8).Tag > 200 Then
         If Picture1(i + 8).Tag = 220 Or Picture1(i + 8).Tag = 250 Then
             wpindex = i + 8
             cntw = cntw + 1
         Else
             cntw = cntw + 1
         End If
      End If
      If Picture1(i + 8).Tag > 100 And Picture1(i + 8).Tag < 200 Then
             bflag = 1
             bpindex = i + 8
             ru(ruc) = i + 8
             ruc = ruc + 1
            Exit Do
         End If
         If cntw = 2 Then
             Exit Do
         End If
         ru(ruc) = i + 8
         ruc = ruc + 1
         i = i + 8
     Else
     Exit Do
     End If
Loop

If cntw = 2 Then
ruc = 0
End If
If bflag = 1 And cntw = 1 Then
   If Picture1(bpindex).Tag = 120 Or Picture1(bpindex).Tag = 150 Then
    piece(2) = 1
   Else
      ruc = 0
   End If
   
End If
If bflag = 1 And cntw = 0 Then
   If Picture1(bpindex).Tag = 120 Or Picture1(bpindex).Tag = 150 Then
    checkflag = 1
     piece(2) = 2
   End If
End If

bflag = 0
cntw = 0
wpindex = -10
row = index \ 8
rdc = 0
i = index
Do While 1
    flag = 0
    If (i - 8) \ 8 = row - 1 And row - 1 >= 0 Then
       row = row - 1
       If Picture1(i - 8).Tag > 200 Then
         If Picture1(i - 8).Tag = 220 Or Picture1(i - 8).Tag = 250 Then
             wpindex = i - 8
             cntw = cntw + 1
          Else
             cntw = cntw + 1
         End If
       End If
         If Picture1(i - 8).Tag > 100 And Picture1(i - 8).Tag < 200 Then
             bflag = 1
             bpindex = i - 8
             rd(rdc) = i - 8
             rdc = rdc + 1
            Exit Do
         End If
         If cntw = 2 Then
             Exit Do
         End If
         rd(rdc) = i - 8
         rdc = rdc + 1
         i = i - 8
     Else
     Exit Do
     End If
Loop

If cntw = 2 Then
rdc = 0
End If
If bflag = 1 And cntw = 1 Then
   If Picture1(bpindex).Tag = 120 Or Picture1(bpindex).Tag = 150 Then
    piece(3) = 1
   Else
      rdc = 0
   End If
   
End If
If bflag = 1 And cntw = 0 Then
   If Picture1(bpindex).Tag = 120 Or Picture1(bpindex).Tag = 150 Then
    checkflag = 1
     piece(3) = 2
   End If
End If

                  'Bishop
bflag = 0
cntw = 0
wpindex = -10
bldc = 0
inc = 1
row = index \ 8
i = index
Do While 1
    flag = 0
    If (i + inc * 7) \ 8 = (inc + row) And (i + inc * 7) < 64 Then
      If (Picture1(i + inc * 7).Tag > 200) Then
        If (Picture1(i + inc * 7).Tag = 240 Or Picture1(i + inc * 7).Tag = 250) Then
            wpindex = i + inc * 7
            cntw = cntw + 1
        Else
            cntw = cntw + 1
        End If
      End If
      If Picture1(i + inc * 7).Tag > 100 And Picture1(i + inc * 7).Tag < 200 Then
             bflag = 1
             bpindex = i + inc * 7
             bld(bldc) = i + inc * 7
             bldc = bldc + 1
             Exit Do
        End If
        If cntw = 2 Then
             Exit Do
        End If
        bld(bldc) = i + inc * 7
        bldc = bldc + 1
        inc = inc + 1
  Else
     Exit Do
  End If
Loop

If cntw = 2 Then
bldc = 0
End If
If bflag = 1 And cntw = 1 Then
   If Picture1(bpindex).Tag = 140 Or Picture1(bpindex).Tag = 150 Then
     piece(4) = 1
   Else
      bldc = 0
   End If
   
End If
If bflag = 1 And cntw = 0 Then
   If Picture1(bpindex).Tag = 140 Or Picture1(bpindex).Tag = 150 Then
     checkflag = 1
     piece(4) = 2
   End If
End If

bflag = 0
cntw = 0
wpindex = -10
brdc = 0
inc = 1
row = index \ 8
i = index
Do While 1
    flag = 0
    If (i + inc * 9) \ 8 = (inc + row) And (i + inc * 9) < 64 Then
      If (Picture1(i + inc * 9).Tag) > 200 Then
        If (Picture1(i + inc * 9).Tag = 240 Or Picture1(i + inc * 9).Tag = 250) Then
            wpindex = i + inc * 9
            cntw = cntw + 1
        Else
            cntw = cntw + 1
        End If
      End If
      If Picture1(i + inc * 9).Tag > 100 And Picture1(i + inc * 9).Tag < 200 Then
             bflag = 1
             bpindex = i + inc * 9
             brd(brdc) = i + inc * 9
             brdc = brdc + 1
            Exit Do
        End If
        If cntw = 2 Then
             Exit Do
        End If
        brd(brdc) = i + inc * 9
        brdc = brdc + 1
        inc = inc + 1
  Else
     Exit Do
  End If
Loop

If cntw = 2 Then
brdc = 0
End If
If bflag = 1 And cntw = 1 Then
   If Picture1(bpindex).Tag = 140 Or Picture1(bpindex).Tag = 150 Then
     piece(5) = 1
   Else
      brdc = 0
   End If
   
End If
If bflag = 1 And cntw = 0 Then
   If Picture1(bpindex).Tag = 140 Or Picture1(bpindex).Tag = 150 Then
    checkflag = 1
     piece(5) = 2
   End If
End If


bflag = 0
cntw = 0
wpindex = -10
bluc = 0
inc = 1
row = index \ 8
i = index
Do While 1
    flag = 0
    If (i - inc * 9) \ 8 = (row - inc) And (i - inc * 9) >= 0 Then
      If Picture1(i - inc * 9).Tag > 200 Then
        If (Picture1(i - inc * 9).Tag = 240 Or Picture1(i - inc * 9).Tag = 250) Then
            wpindex = i - inc * 9
            cntw = cntw + 1
        Else
            cntw = cntw + 1
        End If
      End If
      If Picture1(i - inc * 9).Tag > 100 And Picture1(i - inc * 9).Tag < 200 Then
              bflag = 1
             bpindex = i - inc * 9
             blu(bluc) = i - inc * 9
             bluc = bluc + 1
            Exit Do
        End If
        If cntw = 2 Then
             Exit Do
        End If
        blu(bluc) = i - inc * 9
        bluc = bluc + 1
        inc = inc + 1
  Else
     Exit Do
  End If
Loop

If cntw = 2 Then
bluc = 0
End If
If bflag = 1 And cntw = 1 Then
   If Picture1(bpindex).Tag = 140 Or Picture1(bpindex).Tag = 150 Then
     piece(6) = 1
   Else
      bluc = 0
   End If
   
End If
If bflag = 1 And cntw = 0 Then
   If Picture1(bpindex).Tag = 140 Or Picture1(bpindex).Tag = 150 Then
    checkflag = 1
     piece(6) = 2
   End If
End If

bflag = 0
cntw = 0
wpindex = -10
bruc = 0
inc = 1
row = index \ 8
i = index
Do While 1
    flag = 0
    If (i - inc * 7) \ 8 = (row - inc) And (i - inc * 7) >= 0 Then
      If Picture1(i - inc * 7).Tag > 200 Then
        If (Picture1(i - inc * 7).Tag = 240 Or Picture1(i - inc * 7).Tag = 250) Then
            wpindex = i - inc * 7
            cntw = cntw + 1
        Else
            cntw = cntw + 1
        End If
      End If
      If Picture1(i - inc * 7).Tag > 100 And Picture1(i - inc * 7).Tag < 200 Then
             bflag = 1
             bpindex = i - inc * 7
             bru(bruc) = i - inc * 7
             bruc = bruc + 1
            Exit Do
        End If
        If cntw = 2 Then
             Exit Do
        End If
        bru(bruc) = i - inc * 7
        bruc = bruc + 1
        inc = inc + 1
  Else
     Exit Do
  End If
Loop

If cntw = 2 Then
bruc = 0
End If
If bflag = 1 And cntw = 1 Then
   If Picture1(bpindex).Tag = 140 Or Picture1(bpindex).Tag = 150 Then
     piece(7) = 1
    Else
      bruc = 0
   End If
   
End If
If bflag = 1 And cntw = 0 Then
   If Picture1(bpindex).Tag = 140 Or Picture1(bpindex).Tag = 150 Then
    checkflag = 1
     piece(7) = 2
   End If
End If

cnt = 0
cnt1 = 0

End Function

Function wkingmov(index As Integer)
Dim i As Integer, j As Integer, temp As Integer, orgmov(8) As Integer, orgkill(8) As Integer, temp2 As Integer, flag As Integer
castlel = 0
castler = 0
kingcnt = 0
For i = 0 To 63
    If Picture1(i).Tag = 210 Or Picture1(i).Tag = 211 Then
        temp = Picture1(i).Tag
        t = bpawn(i)
        Picture1(i).Tag = temp
        calkingcnt
    ElseIf Picture1(i).Tag > 219 And Picture1(i).Tag < 230 Then
        t = brook(i)
        calkingcnt
    ElseIf Picture1(i).Tag > 229 And Picture1(i).Tag < 239 Then
        t = bknight(i)
        calkingcnt
    ElseIf Picture1(i).Tag > 239 And Picture1(i).Tag < 249 Then
        t = bbishap(i)
        calkingcnt
    ElseIf Picture1(i).Tag > 249 And Picture1(i).Tag < 259 Then
            t = bbishap(i)
            calkingcnt
            t = brook(i)
            calkingcnt
    ElseIf Picture1(i).Tag > 259 And Picture1(i).Tag < 269 Then
          t = kingpos(i)
          calkingcnt
    End If
Next
temp1(0) = index - 9
temp1(1) = index - 8
temp1(2) = index - 7
temp1(3) = index + 1
temp1(4) = index + 9
temp1(5) = index + 8
temp1(6) = index + 7
temp1(7) = index - 1

row = index \ 8
For i = 0 To kingcnt - 1
    If index - 9 = kingmov(i) Then
        temp1(0) = 0
    ElseIf index - 8 = kingmov(i) Then
        temp1(1) = 0
    ElseIf index - 7 = kingmov(i) Then
        temp1(2) = 0
    ElseIf index + 1 = kingmov(i) Then
        temp1(3) = 0
    ElseIf index + 9 = kingmov(i) Then
        temp1(4) = 0
    ElseIf index + 8 = kingmov(i) Then
        temp1(5) = 0
    ElseIf index + 7 = kingmov(i) Then
        temp1(6) = 0
    ElseIf index - 1 = kingmov(i) Then
        temp1(7) = 0
    End If
Next

For i = 0 To 8
    If piece(i) = 2 Then
        If i = 0 Then
             temp1(7) = 0
        ElseIf i = 1 Then
            temp1(3) = 0
        ElseIf i = 2 Then
            temp1(1) = 0
        ElseIf i = 3 Then
            temp1(5) = 0
        ElseIf i = 4 Then
            temp1(2) = 0
        ElseIf i = 5 Then
            temp1(0) = 0
        ElseIf i = 6 Then
            temp1(4) = 0
        ElseIf i = 7 Then
            temp1(6) = 0
        End If
    End If
Next
    

cnt = 0
cnt1 = 0
If temp1(0) <> 0 Then
    If (index - 9) \ 8 = row - 1 And index - 9 >= 0 Then
        If Picture1(temp1(0)).Tag > 200 Then
            kill(cnt1) = temp1(0)
            cnt1 = cnt1 + 1
        End If
        If Picture1(temp1(0)).Tag = 0 Or Picture1(temp1(0)).Tag > 200 Then
            mov(cnt) = temp1(0)
            cnt = cnt + 1
        End If
    End If
End If
If temp1(1) <> 0 Then
    If index - 8 >= 0 Then
        If Picture1(temp1(1)).Tag > 200 Then
            kill(cnt1) = temp1(1)
            cnt1 = cnt1 + 1
        End If
        If Picture1(temp1(1)).Tag = 0 Or Picture1(temp1(1)).Tag > 200 Then
            mov(cnt) = temp1(1)
            cnt = cnt + 1
        End If
    End If
End If
If temp1(2) <> 0 Then
    If (index - 7) \ 8 = row - 1 And index - 7 >= 0 Then
        If Picture1(temp1(2)).Tag > 200 Then
            kill(cnt1) = temp1(2)
            cnt1 = cnt1 + 1
        End If
        If Picture1(temp1(2)).Tag = 0 Or Picture1(temp1(2)).Tag > 200 Then
            mov(cnt) = temp1(2)
            cnt = cnt + 1
        End If
    End If
End If
If temp1(3) <> 0 Then
    If (index + 1) \ 8 = row And index + 1 <= 63 Then
        If Picture1(temp1(3)).Tag > 200 Then
            kill(cnt1) = temp1(3)
            cnt1 = cnt1 + 1
        End If
        If Picture1(temp1(3)).Tag = 0 Or Picture1(temp1(3)).Tag > 200 Then
            mov(cnt) = temp1(3)
            cnt = cnt + 1
        End If
    End If
End If
If temp1(4) <> 0 Then
    If (index + 9) \ 8 = row + 1 And index + 9 <= 63 Then
        If Picture1(temp1(4)).Tag > 200 Then
            kill(cnt1) = temp1(4)
            cnt1 = cnt1 + 1
        End If
        If Picture1(temp1(4)).Tag = 0 Or Picture1(temp1(4)).Tag > 200 Then
            mov(cnt) = temp1(4)
            cnt = cnt + 1
        End If
    End If
End If
If temp1(5) <> 0 Then
    If index + 8 <= 63 Then
        If Picture1(temp1(5)).Tag > 200 Then
            kill(cnt1) = temp1(5)
            cnt1 = cnt1 + 1
        End If
        If Picture1(temp1(5)).Tag = 0 Or Picture1(temp1(5)).Tag > 200 Then
            mov(cnt) = temp1(5)
            cnt = cnt + 1
        End If
    End If
End If
If temp1(6) <> 0 Then
    If (index + 7) \ 8 = row + 1 And index + 7 <= 63 Then
        If Picture1(temp1(6)).Tag > 200 Then
            kill(cnt1) = temp1(6)
            cnt1 = cnt1 + 1
        End If
        If Picture1(temp1(6)).Tag = 0 Or Picture1(temp1(6)).Tag > 200 Then
            mov(cnt) = temp1(6)
            cnt = cnt + 1
        End If
    End If
End If
If temp1(7) <> 0 Then
    If (index - 1) \ 8 = row And index - 1 >= 0 Then
        If Picture1(temp1(7)).Tag > 200 Then
            kill(cnt1) = temp1(7)
            cnt1 = cnt1 + 1
        End If
        If Picture1(temp1(7)).Tag = 0 Or Picture1(temp1(7)).Tag > 200 Then
            mov(cnt) = temp1(7)
            cnt = cnt + 1
        End If
    End If
End If

For i = 0 To cnt - 1
orgmov(i) = mov(i)
Next

For i = 0 To cnt1 - 1
orgkill(i) = kill(i)
Next
temp2 = cnt
temp = cnt1
For i = 0 To temp - 1
      wking (orgkill(i))
      For j = 0 To 9
           If piece(j) = 2 Then
                 For k = 0 To temp2 - 1
                      If orgkill(i) = orgmov(k) Then
                        flag = k
                        Exit For
                     End If
                 Next
                 
                 For k = flag To temp2 - 1
                     orgmov(k) = orgmov(k + 1)
                 Next
                 For k = i To temp - 1
                     orgkill(k) = orgkill(k + 1)
                 Next
                 temp = temp - 1
                 temp2 = temp2 - 1
                 Exit For
          End If
    Next
Next

For k = 0 To temp2 - 1
   mov(k) = orgmov(k)
Next
For k = 0 To temp - 1
    kill(k) = orgkill(k)
Next
cnt = temp2
cnt1 = temp
checkflag = 0
For i = 0 To 9
    If piece(i) = 2 Then
        checkflag = 1
    End If
Next

If checkflag = 0 And (wr = 0 Or wl = 0) Then
    wcastle
    If castler = 1 Then
        orgmov(temp2) = 62
        temp2 = temp2 + 1
    End If
    If castlel = 1 Then
        orgmov(temp2) = 58
        temp2 = temp2 + 1
    End If
End If

For k = 0 To temp2 - 1
   mov(k) = orgmov(k)
Next
For k = 0 To temp - 1
    kill(k) = orgkill(k)
Next
cnt = temp2
cnt1 = temp

End Function


Function bkingmov(index As Integer)
Dim i As Integer, orgmov(8) As Integer, orgkill(8) As Integer, temp2 As Integer, flag As Integer, j As Integer, k As Integer

kingcnt = 0
castlel = 0
castler = 0

For i = 0 To 8
orgmov(i) = 0
orgkill(i) = 0
Next

For i = 0 To 63
    If Picture1(i).Tag > 109 And Picture1(i).Tag < 120 Then
        temp = Picture1(i).Tag
        t = wpawn(i)
        Picture1(i).Tag = temp
        calkingcnt
    ElseIf Picture1(i).Tag > 119 And Picture1(i).Tag < 130 Then
        t = wrook(i)
        calkingcnt
           


    ElseIf Picture1(i).Tag > 129 And Picture1(i).Tag < 139 Then
        t = wknight(i)
        calkingcnt
    ElseIf Picture1(i).Tag > 139 And Picture1(i).Tag < 149 Then
        t = wbishap(i)
        calkingcnt
    ElseIf Picture1(i).Tag > 149 And Picture1(i).Tag < 159 Then
         t = wbishap(i)
         calkingcnt
         t = wrook(i)
         calkingcnt
     ElseIf Picture1(i).Tag > 159 And Picture1(i).Tag < 169 Then
         kingpos (i)
         calkingcnt
    End If
Next





temp1(0) = index - 9
temp1(1) = index - 8
temp1(2) = index - 7
temp1(3) = index + 1
temp1(4) = index + 9
temp1(5) = index + 8
temp1(6) = index + 7
temp1(7) = index - 1


row = index \ 8

For i = 0 To kingcnt - 1
    If index - 9 = kingmov(i) Then
        temp1(0) = 0
    ElseIf index - 8 = kingmov(i) Then
        temp1(1) = 0
    ElseIf index - 7 = kingmov(i) Then
        temp1(2) = 0
    ElseIf index + 1 = kingmov(i) Then
        temp1(3) = 0
    ElseIf index + 9 = kingmov(i) Then
        temp1(4) = 0
    ElseIf index + 8 = kingmov(i) Then
        temp1(5) = 0
    ElseIf index + 7 = kingmov(i) Then
        temp1(6) = 0
    ElseIf index - 1 = kingmov(i) Then
        temp1(7) = 0
    End If
Next

For i = 0 To 8
    If piece(i) = 2 Then
        If i = 0 Then
             temp1(7) = 0
        ElseIf i = 1 Then
            temp1(3) = 0
        ElseIf i = 2 Then
            temp1(1) = 0
        ElseIf i = 3 Then
            temp1(5) = 0
        ElseIf i = 4 Then
            temp1(2) = 0
        ElseIf i = 5 Then
            temp1(0) = 0
        ElseIf i = 6 Then
            temp1(4) = 0
        ElseIf i = 7 Then
            temp1(6) = 0
        End If
    End If
Next

cnt = 0
cnt1 = 0

If temp1(0) <> 0 Then
    If (index - 9) \ 8 = row - 1 And index - 9 >= 0 Then
        If Picture1(temp1(0)).Tag > 100 And Picture1(temp1(0)).Tag < 200 Then
            kill(cnt1) = temp1(0)
            cnt1 = cnt1 + 1
        End If
        If Picture1(temp1(0)).Tag = 0 Or (Picture1(temp1(0)).Tag > 100 And Picture1(temp1(0)).Tag < 200) Then
            mov(cnt) = temp1(0)
            cnt = cnt + 1
        End If
    End If
End If
If temp1(1) <> 0 Then
    If index - 8 >= 0 Then
        If (Picture1(temp1(1)).Tag > 100 And Picture1(temp1(1)).Tag < 200) Then
            kill(cnt1) = temp1(1)
            cnt1 = cnt1 + 1
        End If
        If Picture1(temp1(1)).Tag = 0 Or (Picture1(temp1(1)).Tag > 100 And Picture1(temp1(1)).Tag < 200) Then
            mov(cnt) = temp1(1)
            cnt = cnt + 1
        End If
    End If
End If
If temp1(2) <> 0 Then
    If (index - 7) \ 8 = row - 1 And index - 7 >= 0 Then
        If (Picture1(temp1(2)).Tag > 100 And Picture1(temp1(2)).Tag < 200) Then
            kill(cnt1) = temp1(2)
            cnt1 = cnt1 + 1
        End If
        If Picture1(temp1(2)).Tag = 0 Or (Picture1(temp1(2)).Tag > 100 And Picture1(temp1(2)).Tag < 200) Then
            mov(cnt) = temp1(2)
            cnt = cnt + 1
        End If
    End If
End If
If temp1(3) <> 0 Then
    If (index + 1) \ 8 = row And index + 1 <= 63 Then
        If (Picture1(temp1(3)).Tag > 100 And Picture1(temp1(3)).Tag < 200) Then
            kill(cnt1) = temp1(3)
            cnt1 = cnt1 + 1
        End If
        If Picture1(temp1(3)).Tag = 0 Or (Picture1(temp1(3)).Tag > 100 And Picture1(temp1(3)).Tag < 200) Then
            mov(cnt) = temp1(3)
            cnt = cnt + 1
        End If
    End If
End If
If temp1(4) <> 0 Then
    If (index + 9) \ 8 = row + 1 And index + 9 <= 63 Then
        If (Picture1(temp1(4)).Tag > 100 And Picture1(temp1(4)).Tag < 200) Then
            kill(cnt1) = temp1(4)
            cnt1 = cnt1 + 1
        End If
        If Picture1(temp1(4)).Tag = 0 Or (Picture1(temp1(4)).Tag > 100 And Picture1(temp1(4)).Tag < 200) Then
            mov(cnt) = temp1(4)
            cnt = cnt + 1
        End If
    End If
End If
If temp1(5) <> 0 Then
    If index + 8 <= 63 Then
        If (Picture1(temp1(5)).Tag > 100 And Picture1(temp1(5)).Tag < 200) Then
            kill(cnt1) = temp1(5)
            cnt1 = cnt1 + 1
        End If
        If Picture1(temp1(5)).Tag = 0 Or (Picture1(temp1(5)).Tag > 100 And Picture1(temp1(5)).Tag < 200) Then
            mov(cnt) = temp1(5)
            cnt = cnt + 1
        End If
    End If
End If
If temp1(6) <> 0 Then
    If (index + 7) \ 8 = row + 1 And index + 7 <= 63 Then
        If (Picture1(temp1(6)).Tag > 100 And Picture1(temp1(6)).Tag < 200) Then
            kill(cnt1) = temp1(6)
            cnt1 = cnt1 + 1
        End If
        If Picture1(temp1(6)).Tag = 0 Or (Picture1(temp1(6)).Tag > 100 And Picture1(temp1(6)).Tag < 200) Then
            mov(cnt) = temp1(6)
            cnt = cnt + 1
        End If
    End If
End If
If temp1(7) <> 0 Then
    If (index - 1) \ 8 = row And index - 1 >= 0 Then
        If (Picture1(temp1(7)).Tag > 100 And Picture1(temp1(7)).Tag < 200) Then
            kill(cnt1) = temp1(7)
            cnt1 = cnt1 + 1
        End If
        If Picture1(temp1(7)).Tag = 0 Or (Picture1(temp1(7)).Tag > 100 And Picture1(temp1(7)).Tag < 200) Then
            mov(cnt) = temp1(7)
            cnt = cnt + 1
        End If
    End If
End If



For i = 0 To cnt - 1
orgmov(i) = mov(i)
Next

For i = 0 To cnt1 - 1
orgkill(i) = kill(i)
Next

temp2 = cnt
temp = cnt1
cnt = 0
cnt1 = 0
For i = 0 To temp - 1
      bking (orgkill(i))
      For j = 0 To 9
           If piece(j) = 2 Then
                 For k = 0 To temp2 - 1
                      If orgkill(i) = orgmov(k) Then
                        flag = k
                        Exit For
                     End If
                 Next
               
                 For k = flag + 1 To temp2 - 1
                     orgmov(k - 1) = orgmov(k)
                 Next
                 For k = i + 1 To temp - 1
                     orgkill(k - 1) = orgkill(k)
                 Next
                 temp = temp - 1
                 temp2 = temp2 - 1
                 Exit For
          End If
    Next
Next

For k = 0 To temp2 - 1
   mov(k) = orgmov(k)
Next
For k = 0 To temp - 1
    kill(k) = orgkill(k)
Next

cnt = temp2
cnt1 = temp

checkflag = 0
For i = 0 To 9
    If piece(i) = 2 Then
        checkflag = 1
    End If
Next

If checkflag = 0 And (br = 0 Or bl = 0) Then
    bcastle
    If castler = 1 Then
        orgmov(temp2) = 6
        temp2 = temp2 + 1
    End If
    If castlel = 1 Then
        orgmov(temp2) = 2
        temp2 = temp2 + 1
    End If
End If

For k = 0 To temp2 - 1
   mov(k) = orgmov(k)
Next
For k = 0 To temp - 1
    kill(k) = orgkill(k)
Next
cnt = temp2
cnt1 = temp

End Function

Function disable(index As Integer)

pieceflag = 0
For i = 0 To rrc - 1
     If index = rr(i) And piece(0) = 1 Then
       pieceflag = 1
     Exit For
     End If
Next

For i = 0 To rlc - 1
     If index = rl(i) And piece(1) = 1 Then
       pieceflag = 2
     Exit For
     End If
Next

For i = 0 To ruc - 1
     If index = ru(i) And piece(2) = 1 Then
       pieceflag = 3
     Exit For
     End If
Next

For i = 0 To rdc - 1
     If index = rd(i) And piece(3) = 1 Then
       pieceflag = 4
     Exit For
     End If
Next

For i = 0 To bldc - 1
     If index = bld(i) And piece(4) = 1 Then
       pieceflag = 5
     Exit For
     End If
Next
For i = 0 To brdc - 1
     If index = brd(i) And piece(5) = 1 Then
       pieceflag = 6
     Exit For
     End If
Next
For i = 0 To bluc - 1
     If index = blu(i) And piece(6) = 1 Then
       pieceflag = 7
     Exit For
     End If
Next
For i = 0 To bruc - 1
     If index = bru(i) And piece(7) = 1 Then
       pieceflag = 8
     Exit For
     End If
Next

End Function

Function disablepawn(index As Integer)
disable (index)

If pieceflag = 1 And piece(0) = 1 Then
k = 0
For i = 0 To cnt - 1
    For j = 0 To rrc - 1
        If mov(i) = rr(j) Then
           temp1(k) = mov(i)
           k = k + 1
        End If
    Next
Next
cnt = k
cnt1 = 0
For i = 0 To cnt - 1
mov(i) = temp1(i)
Next
End If

If pieceflag = 2 And piece(1) = 1 Then
k = 0
For i = 0 To cnt - 1
    For j = 0 To rlc - 1
        If mov(i) = rl(j) Then
        temp1(k) = mov(i)
        k = k + 1
        End If
    Next
Next
cnt = k
cnt1 = 0
For i = 0 To cnt - 1
mov(i) = temp1(i)
Next
End If

If pieceflag = 3 And piece(2) = 1 Then
k = 0
For i = 0 To cnt - 1
    For j = 0 To ruc - 1
        If mov(i) = ru(j) Then
        temp1(k) = mov(i)
        k = k + 1
        End If
    Next
Next
cnt = k
cnt1 = 0
For i = 0 To cnt - 1
mov(i) = temp1(i)
Next
End If

If pieceflag = 4 And piece(3) = 1 Then
k = 0
For i = 0 To cnt - 1
    For j = 0 To rdc - 1
        If mov(i) = rd(j) Then
        temp1(k) = mov(i)
        k = k + 1
        End If
    Next
Next
cnt = k
cnt1 = 0
For i = 0 To cnt - 1
mov(i) = temp1(i)
Next
End If

If piece(4) = 1 And pieceflag = 5 Then
k = 0
For i = 0 To cnt - 1
    For j = 0 To bldc - 1
        If mov(i) = bld(j) Then
          temp1(k) = mov(i)
          k = k + 1
        End If
    Next
Next
cnt = k

If bldc = 2 Then
   kill(0) = bld(bldc - 1)
   cnt1 = 1
Else
cnt1 = 0
End If

For i = 0 To cnt - 1
mov(i) = temp1(i)
Next
End If

If piece(5) = 1 And pieceflag = 6 Then
k = 0
For i = 0 To cnt - 1
    For j = 0 To brdc - 1
        If mov(i) = brd(j) Then
        temp1(k) = mov(i)
        k = k + 1
        End If
    Next
Next
cnt = k
If brdc = 2 Then
   kill(0) = brd(brdc - 1)
   cnt1 = 1
Else
cnt1 = 0
End If
For i = 0 To cnt - 1
mov(i) = temp1(i)
Next
End If

If piece(6) = 1 And pieceflag = 7 Then
k = 0
For i = 0 To cnt - 1
    For j = 0 To bluc - 1
        If mov(i) = blu(j) Then
        temp1(k) = mov(i)
        k = k + 1
        End If
    Next
Next
cnt = k
If bluc = 2 Then
   kill(0) = blu(bluc - 1)
   cnt1 = 1
Else
cnt1 = 0
End If
For i = 0 To cnt - 1
mov(i) = temp1(i)
Next
End If

If piece(7) = 1 And pieceflag = 8 Then
k = 0
For i = 0 To cnt - 1
    For j = 0 To bruc - 1
        If mov(i) = bru(j) Then
        temp1(k) = mov(i)
        k = k + 1
        End If
    Next
Next
cnt = k
If bruc = 2 Then
   kill(0) = bru(bruc - 1)
   cnt1 = 1
Else
cnt1 = 0
End If
For i = 0 To cnt - 1
mov(i) = temp1(i)
Next
End If

End Function

Function savecheck(index As Integer)
Dim i, j, k, z, killflag As Integer

For i = 0 To 9
    If piece(i) = 2 Then
       z = z + 1
    End If
Next


If z = 1 Then

killflag = 0
If piece(0) = 2 Then
cnt1 = 0
k = 0
For i = 0 To cnt - 1
    For j = 0 To rrc - 1
        If mov(i) = rr(j) Then
            If mov(i) = rr(rrc - 1) Then
               killflag = 1
            End If
            temp1(k) = mov(i)
            k = k + 1
        End If
    Next
Next
cnt = k
If killflag = 1 Then
cnt1 = 1
kill(0) = rr(rrc - 1)
End If

For i = 0 To cnt - 1
mov(i) = temp1(i)
Next
End If

killflag = 0
If piece(1) = 2 Then
cnt1 = 0
k = 0
For i = 0 To cnt - 1
    For j = 0 To rlc - 1
        If mov(i) = rl(j) Then
            If mov(i) = rl(rlc - 1) Then
               killflag = 1
            End If
        temp1(k) = mov(i)
        k = k + 1
        End If
    Next
Next
cnt = k
If killflag = 1 Then
cnt1 = 1
kill(0) = rl(rlc - 1)
End If
For i = 0 To cnt - 1
mov(i) = temp1(i)
Next
End If

killflag = 0
If piece(2) = 2 Then
cnt1 = 0
k = 0
For i = 0 To cnt - 1
    For j = 0 To ruc - 1
        If mov(i) = ru(j) Then
            If mov(i) = ru(ruc - 1) Then
               killflag = 1
            End If
        temp1(k) = mov(i)
        k = k + 1
        End If
    Next
Next
cnt = k
If killflag = 1 Then
cnt1 = 1
kill(0) = ru(ruc - 1)
End If
For i = 0 To cnt - 1
mov(i) = temp1(i)
Next
End If

killflag = 0
If piece(3) = 2 Then
cnt1 = 0
k = 0
For i = 0 To cnt - 1
    For j = 0 To rdc - 1
        If mov(i) = rd(j) Then
            If mov(i) = rd(rdc - 1) Then
               killflag = 1
            End If

        temp1(k) = mov(i)
        k = k + 1
        End If
    Next
Next
cnt = k
If killflag = 1 Then
cnt1 = 1
kill(0) = rd(rdc - 1)
End If
For i = 0 To cnt - 1
mov(i) = temp1(i)
Next
End If

killflag = 0
If piece(4) = 2 Then
cnt1 = 0
k = 0
For i = 0 To cnt - 1
    For j = 0 To bldc - 1
        If mov(i) = bld(j) Then
           If mov(i) = bld(bldc - 1) Then
               killflag = 1
            End If

          temp1(k) = mov(i)
          k = k + 1
        End If
    Next
Next
cnt = k
If killflag = 1 Then
cnt1 = 1
kill(0) = bld(bldc - 1)
End If
For i = 0 To cnt - 1
mov(i) = temp1(i)
Next
End If

killflag = 0

If piece(5) = 2 Then
cnt1 = 0
k = 0
For i = 0 To cnt - 1
    For j = 0 To brdc - 1
        If mov(i) = brd(j) Then
            If mov(i) = brd(brdc - 1) Then
               killflag = 1
            End If

        temp1(k) = mov(i)
        k = k + 1
        End If
    Next
Next
cnt = k
If killflag = 1 Then
cnt1 = 1
kill(0) = brd(brdc - 1)
End If
For i = 0 To cnt - 1
mov(i) = temp1(i)
Next
End If

killflag = 0
If piece(6) = 2 Then
cnt1 = 0
k = 0
For i = 0 To cnt - 1
    For j = 0 To bluc - 1
        If mov(i) = blu(j) Then
            If mov(i) = blu(bluc - 1) Then
               killflag = 1
            End If

            temp1(k) = mov(i)
            k = k + 1
        End If
    Next
Next
cnt = k
If killflag = 1 Then
cnt1 = 1
kill(0) = blu(bluc - 1)
End If
For i = 0 To cnt - 1
mov(i) = temp1(i)
Next
End If

killflag = 0
If piece(7) = 2 Then
cnt1 = 0
k = 0
For i = 0 To cnt - 1
    For j = 0 To bruc - 1
        If mov(i) = bru(j) Then
            If mov(i) = bru(bruc - 1) Then
               killflag = 1
            End If

            temp1(k) = mov(i)
            k = k + 1
        End If
    Next
Next
cnt = k
If killflag = 1 Then
cnt1 = 1
kill(0) = bru(bruc - 1)
End If
For i = 0 To cnt - 1
mov(i) = temp1(i)
Next
End If
                
If piece(8) = 2 Then
killflag = 0
If kingflag <> 1 Then
cnt = 0
End If
For i = 0 To cnt1 - 1
    If kill(i) = knightcheck Then
        killflag = 1
        mov(0) = kill(i)
        kill(0) = kill(i)
        cnt = 1
        cnt1 = 1
        Exit For
    End If
Next
If killflag = 0 Then
cnt1 = 0
End If
End If

If piece(9) = 2 Then
killflag = 0
If kingflag <> 1 Then
cnt = 0
End If
For i = 0 To cnt1 - 1
    If kill(i) = pawncheck Then
        killflag = 1
1       mov(0) = kill(i)
        kill(0) = kill(i)
        cnt = 1
        cnt1 = 1
        Exit For
    End If
    
Next
If killflag = 0 Then
cnt1 = 0
End If
End If
End If
End Function


Function kingpos(index As Integer)

row = index \ 8
If (index - 9) \ 8 = row - 1 And index - 9 >= 0 Then
mov(cnt) = index - 9
cnt = cnt + 1
End If
If index - 8 >= 0 Then
mov(cnt) = index - 8
cnt = cnt + 1
End If
If (index - 7) \ 8 = row - 1 And index - 7 >= 0 Then
mov(cnt) = index - 7
cnt = cnt + 1
End If
If (index + 1) \ 8 = row And index + 1 <= 63 Then
mov(cnt) = index + 1
cnt = cnt + 1
End If
If (index + 9) \ 8 = row + 1 And index + 9 <= 63 Then
mov(cnt) = index + 9
cnt = cnt + 1
End If
If index + 8 <= 63 Then
mov(cnt) = index + 8
cnt = cnt + 1
End If
If (index + 7) \ 8 = row + 1 And index + 7 <= 63 Then
mov(cnt) = index + 7
cnt = cnt + 1
End If
If (index - 1) \ 8 = row And index - 1 >= 0 Then
mov(cnt) = index - 1
cnt = cnt + 1
End If

End Function


Function checkmate()
Dim i As Integer, response As Integer, checkcnt As Integer
cnt = 0
cnt1 = 0
checkcnt = 0
If playerflag = 0 Then
If doublecheck <> 1 Then
For i = 0 To 63
    If Picture1(i).Tag > 109 And Picture1(i).Tag < 120 Then
        temp = Picture1(i).Tag
        t = wpawn(i)
        Picture1(i).Tag = temp
        t = savecheck(i)
        checkcnt = checkcnt + cnt
        cnt = 0
        cnt1 = 0
    ElseIf Picture1(i).Tag > 119 And Picture1(i).Tag < 130 Then
        t = wrook(i)
        t = savecheck(i)
        checkcnt = checkcnt + cnt
        cnt = 0
        cnt1 = 0
    ElseIf Picture1(i).Tag > 129 And Picture1(i).Tag < 139 Then
        t = wknight(i)
        t = savecheck(i)
        checkcnt = checkcnt + cnt
        cnt = 0
        cnt1 = 0

    ElseIf Picture1(i).Tag > 139 And Picture1(i).Tag < 149 Then
        t = wbishap(i)
        t = savecheck(i)
        checkcnt = checkcnt + cnt
        cnt = 0
        cnt1 = 0

    ElseIf Picture1(i).Tag > 149 And Picture1(i).Tag < 159 Then
         t = wbishap(i)
         t = savecheck(i)
         checkcnt = checkcnt + cnt
         cnt = 0
        cnt1 = 0

         t = wrook(i)
         t = savecheck(i)
         checkcnt = checkcnt + cnt
        cnt = 0
        cnt1 = 0
   
    End If
    If checkcnt > 0 Then
    Exit For
    End If
Next
Else
checkcnt = 0
End If
cnt = 0
cnt1 = 0


wking (wkingloc)
kingflag = 1
wkingmov (wkingloc)
checkcnt = checkcnt + cnt

cnt = 0
cnt1 = 0

If checkcnt = 0 Then
response = MsgBox("Black wins", vbOKOnly, "Checkmate")
End If


Else
If doublecheck <> 1 Then
For i = 0 To 63
    If Picture1(i).Tag > 209 And Picture1(i).Tag < 220 Then
        temp = Picture1(i).Tag
        t = bpawn(i)
        Picture1(i).Tag = temp
        t = savecheck(i)
        checkcnt = checkcnt + cnt
        cnt = 0
        cnt1 = 0

     ElseIf Picture1(i).Tag > 219 And Picture1(i).Tag < 230 Then
        t = brook(i)
        t = savecheck(i)
        checkcnt = checkcnt + cnt
        cnt = 0
        cnt1 = 0

    ElseIf Picture1(i).Tag > 229 And Picture1(i).Tag < 239 Then
        t = bknight(i)
        t = savecheck(i)
        checkcnt = checkcnt + cnt
        cnt = 0
        cnt1 = 0

    
    ElseIf Picture1(i).Tag > 239 And Picture1(i).Tag < 249 Then
        t = bbishap(i)
        t = savecheck(i)
        checkcnt = checkcnt + cnt
        cnt = 0
        cnt1 = 0

    ElseIf Picture1(i).Tag > 249 And Picture1(i).Tag < 259 Then
         t = bbishap(i)
         t = savecheck(i)
         checkcnt = checkcnt + cnt
        cnt = 0
        cnt1 = 0

         t = brook(i)
         t = savecheck(i)
         checkcnt = checkcnt + cnt
        cnt = 0
        cnt1 = 0
  
     End If
     If checkcnt > 0 Then
    Exit For
    End If
Next

Else
checkcnt = 0
End If

cnt = 0
cnt1 = 0

bking (bkingloc)
kingflag = 1
bkingmov (bkingloc)
checkcnt = checkcnt + cnt

cnt = 0
cnt1 = 0

If checkcnt = 0 Then
response = MsgBox("White wins", vbOKOnly, "Checkmate")
End If
End If
saveflag = 0
kingflag = 0
cnt = 0
cnt1 = 0
For i = 0 To 200
        mov(i) = 0
        If i < 50 Then
                kill(i) = 0
           End If
  Next
End Function

Function calkingcnt()

Dim j As Integer

For j = 0 To cnt - 1
    kingmov(kingcnt + j) = mov(j)
Next
kingcnt = kingcnt + cnt
cnt = 0

End Function



Function draw()
Dim i As Integer, response As Integer, checkcnt As Integer
cnt = 0
cnt1 = 0
checkcnt = 0
If playerflag = 0 Then
For i = 0 To 63
    If Picture1(i).Tag > 109 And Picture1(i).Tag < 120 Then
        temp = Picture1(i).Tag
        t = wpawn(i)
        Picture1(i).Tag = temp
        checkcnt = checkcnt + cnt
        cnt = 0
        cnt1 = 0
    ElseIf Picture1(i).Tag > 119 And Picture1(i).Tag < 130 Then
        t = wrook(i)
        checkcnt = checkcnt + cnt
        cnt = 0
        cnt1 = 0
    ElseIf Picture1(i).Tag > 129 And Picture1(i).Tag < 139 Then
        t = wknight(i)
        checkcnt = checkcnt + cnt
        cnt = 0
        cnt1 = 0

    ElseIf Picture1(i).Tag > 139 And Picture1(i).Tag < 149 Then
        t = wbishap(i)
        checkcnt = checkcnt + cnt
        cnt = 0
        cnt1 = 0

    ElseIf Picture1(i).Tag > 149 And Picture1(i).Tag < 159 Then
         t = wbishap(i)
         
         checkcnt = checkcnt + cnt
         cnt = 0
        cnt1 = 0

         t = wrook(i)
        checkcnt = checkcnt + cnt
        cnt = 0
        cnt1 = 0
   
    End If
    If checkcnt > 0 Then
    Exit For
    End If
Next

cnt = 0
cnt1 = 0

wking (wkingloc)
kingflag = 1
wkingmov (wkingloc)
checkcnt = checkcnt + cnt

cnt = 0
cnt1 = 0
kingflag = 0
Else
For i = 0 To 63
    If Picture1(i).Tag > 209 And Picture1(i).Tag < 220 Then
        temp = Picture1(i).Tag
        t = bpawn(i)
        Picture1(i).Tag = temp
        checkcnt = checkcnt + cnt
        cnt = 0
        cnt1 = 0

     ElseIf Picture1(i).Tag > 219 And Picture1(i).Tag < 230 Then
        t = brook(i)
        checkcnt = checkcnt + cnt
        cnt = 0
        cnt1 = 0

    ElseIf Picture1(i).Tag > 229 And Picture1(i).Tag < 239 Then
        t = bknight(i)
        checkcnt = checkcnt + cnt
        cnt = 0
        cnt1 = 0

    
    ElseIf Picture1(i).Tag > 239 And Picture1(i).Tag < 249 Then
        t = bbishap(i)
        checkcnt = checkcnt + cnt
        cnt = 0
        cnt1 = 0

    ElseIf Picture1(i).Tag > 249 And Picture1(i).Tag < 259 Then
         t = bbishap(i)
         checkcnt = checkcnt + cnt
        cnt = 0
        cnt1 = 0

         t = brook(i)
         checkcnt = checkcnt + cnt
        cnt = 0
        cnt1 = 0
  
     End If
     If checkcnt > 0 Then
    Exit For
    End If
Next

cnt = 0
cnt1 = 0

bking (bkingloc)
kingflag = 1
bkingmov (bkingloc)
checkcnt = checkcnt + cnt

cnt = 0
cnt1 = 0


End If
saveflag = 0
kingflag = 0
cnt = 0
cnt1 = 0
For i = 0 To 200
        mov(i) = 0
        If i < 50 Then
                kill(i) = 0
        End If
Next

If checkcnt = 0 Then
response = MsgBox("Match Draw", vbOKOnly, "Draw")
End If
End Function

Function wcastle()
Dim i, j, cflag, ety As Integer
ety = 0
cflag = 0
checkflag = 0
If wr = 0 Then
    i = wkingloc
    If Picture1(i + 1).Tag = 0 And Picture1(i + 2).Tag = 0 Then
        ety = 1
    End If
    For i = 0 To cnt - 1
        If mov(i) = wkingloc + 1 Then
            cflag = 1
        End If
    Next
    If cflag = 1 And ety = 1 Then
        wking (wkingloc + 2)
        For i = 0 To 9
            If piece(i) = 2 Then
                checkflag = 1
            End If
        Next
        If checkflag = 0 Then
            castler = 1
        End If
    End If
End If

ety = 0
cflag = 0
checkflag = 0

If wl = 0 Then
    i = wkingloc
    If Picture1(i - 1).Tag = 0 And Picture1(i - 2).Tag = 0 And Picture1(i - 3).Tag = 0 Then
        ety = 1
    End If
    For i = 0 To cnt - 1
        If mov(i) = wkingloc - 1 Then
            cflag = 1
        End If
    Next
    If cflag = 1 And ety = 1 Then
        wking (wkingloc - 2)
        For i = 0 To 9
            If piece(i) = 2 Then
                checkflag = 1
            End If
        Next
        If checkflag = 0 Then
            castlel = 1
        End If
    End If
End If
End Function


Function bcastle()
Dim i, j, cflag, ety As Integer
ety = 0
cflag = 0
checkflag = 0
If br = 0 Then
    i = bkingloc
    If Picture1(i + 1).Tag = 0 And Picture1(i + 2).Tag = 0 Then
        ety = 1
    End If
    For i = 0 To cnt - 1
        If mov(i) = bkingloc + 1 Then
            cflag = 1
        End If
    Next
    If cflag = 1 And ety = 1 Then
        bking (bkingloc + 2)
        For i = 0 To 9
            If piece(i) = 2 Then
                checkflag = 1
            End If
        Next
        If checkflag = 0 Then
            castler = 1
        End If
    End If
End If

ety = 0
cflag = 0
checkflag = 0

If bl = 0 Then
    i = bkingloc
    If Picture1(i - 1).Tag = 0 And Picture1(i - 2).Tag = 0 And Picture1(i - 3).Tag = 0 Then
        ety = 1
    End If
    For i = 0 To cnt - 1
        If mov(i) = bkingloc - 1 Then
            cflag = 1
        End If
    Next
    If cflag = 1 And ety = 1 Then
        bking (bkingloc - 2)
        For i = 0 To 9
            If piece(i) = 2 Then
                checkflag = 1
            End If
        Next
        If checkflag = 0 Then
            castlel = 1
        End If
    End If
End If
End Function

